<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffd1df" />
  <title>Valentine Edition ðŸ’˜</title>

  <style>
    :root{
      --pink0:#fff2f7;
      --pink1:#ffd1df;
      --pink2:#ffb4cc;
      --rose:#e1174f;
      --rose2:#ff2d6b;
      --ink:#2a1f24;

      --shadow: 0 26px 70px rgba(0,0,0,.18);
      --shadow2: 0 16px 40px rgba(0,0,0,.12);

      --r: 22px;
      --ease: cubic-bezier(.2,.8,.2,1);
      --ease2: cubic-bezier(.2,.7,.2,1);

      --serif: ui-serif, "Times New Roman", Times, Georgia, serif;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;

      --script: "Brush Script MT","Segoe Script","Lucida Handwriting","Apple Chancery","Snell Roundhand",cursive;

      --line: rgba(225,23,79,.65);
      --line2: rgba(225,23,79,.28);

      --animPlay: running;

      /* Progreso */
      --prog: 0%;
    }

    /* âœ… Tema oscuro (modo noche romÃ¡ntico) */
    body.night{
      background: radial-gradient(900px 700px at 20% 10%, rgba(255,45,107,.18), transparent 55%),
                  linear-gradient(135deg, #120a10, #2a0f1b);
      color: rgba(255,255,255,.88);
      color-scheme: dark;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color: var(--ink);
      font-family: var(--sans);
      overflow:hidden;
      background: linear-gradient(135deg, var(--pink0), var(--pink1));
    }

    /* âœ… Accesibilidad: focus visible */
    button:focus-visible{
      outline: 3px solid rgba(225,23,79,.55);
      outline-offset: 4px;
    }

    /* =========================
       FONDO CON MOVIMIENTO
    ========================== */
    .bg-aurora{
      position: fixed; inset:-22%;
      z-index:-5;
      background:
        radial-gradient(900px 560px at 18% 20%, rgba(225,23,79,.28), transparent 60%),
        radial-gradient(900px 560px at 85% 30%, rgba(255,255,255,.70), transparent 60%),
        radial-gradient(900px 560px at 55% 90%, rgba(255,45,107,.20), transparent 60%),
        linear-gradient(135deg, var(--pink0), var(--pink1));
      filter: saturate(1.10);
      animation: auroraDrift 9s var(--ease2) infinite alternate;
      animation-play-state: var(--animPlay);
    }
    body.night .bg-aurora{
      opacity:.55;
      filter: saturate(1.2) contrast(1.05);
      background:
        radial-gradient(900px 560px at 18% 20%, rgba(255,45,107,.20), transparent 60%),
        radial-gradient(900px 560px at 85% 30%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(900px 560px at 55% 90%, rgba(225,23,79,.20), transparent 60%),
        linear-gradient(135deg, #120a10, #2a0f1b);
    }
    @keyframes auroraDrift{
      from{ transform: translate3d(-1.7%, -1.1%, 0) scale(1.03); }
      to  { transform: translate3d( 1.7%,  1.2%, 0) scale(1.10); }
    }

    .bg-grain{
      position: fixed; inset:-30%;
      z-index:-4;
      opacity:.16;
      background-image:
        repeating-linear-gradient(0deg, rgba(0,0,0,.05) 0px, rgba(0,0,0,.05) 1px, transparent 2px, transparent 6px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.04) 0px, rgba(0,0,0,.04) 1px, transparent 2px, transparent 7px);
      mix-blend-mode: multiply;
      animation: grainMove 7s linear infinite;
      animation-play-state: var(--animPlay);
    }
    body.night .bg-grain{ opacity:.12; mix-blend-mode: screen; }
    @keyframes grainMove{
      0%   { transform: translate3d(-2%, -2%, 0) rotate(0deg); }
      100% { transform: translate3d( 2%,  2%, 0) rotate(1deg); }
    }

    /* PÃ©talos */
    .petals{
      position: fixed; inset:-10%;
      z-index:-3;
      pointer-events:none;
    }
    .petal{
      position:absolute;
      width: 14px; height: 14px;
      border-radius: 6px 14px 6px 14px;
      background: rgba(225,23,79,.30);
      filter: blur(.10px);
      box-shadow: 0 10px 22px rgba(225,23,79,.10);
      animation: fall linear infinite;
      animation-play-state: var(--animPlay);
      transform: rotate(15deg);
    }
    .petal.white{ background: rgba(255,255,255,.72); }
    .petal.soft { background: rgba(255,45,107,.18); }
    body.night .petal.white{ background: rgba(255,255,255,.38); }
    @keyframes fall{
      0%   { transform: translate3d(var(--x), -140px, 0) rotate(0deg); opacity:0; }
      10%  { opacity:var(--op); }
      100% { transform: translate3d(calc(var(--x) + var(--drift)), 120vh, 0) rotate(340deg); opacity:0; }
    }

    @media (prefers-reduced-motion: reduce){
      .bg-aurora, .bg-grain, .petal{ animation:none !important; }
    }

    /* =========================
       INTRO: SOBRE / CARTA
    ========================== */
    .intro{
      position: fixed; inset:0;
      z-index: 50;
      display:grid;
      place-items:center;
      padding: 18px;
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      transition: opacity .55s var(--ease), transform .55s var(--ease);
    }
    .intro.hide{
      opacity:0;
      transform: translateY(-10px);
      pointer-events:none;
    }

    .introCard{
      width: min(520px, 92vw);
      border-radius: var(--r);
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(255,255,255,.85);
      box-shadow: var(--shadow);
      padding: 20px 18px 22px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    body.night .introCard{
      background: rgba(20,12,18,.55);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.88);
    }
    .introTitle{
      font-family: var(--serif);
      color: rgba(225,23,79,.92);
      font-weight: 900;
      font-size: 18px;
      margin: 2px 0 8px;
    }
    body.night .introTitle{ color: rgba(255,122,152,.95); }
    .introSub{
      color: rgba(91,73,82,.80);
      font-size: 13.5px;
      margin: 0 0 14px;
    }
    body.night .introSub{ color: rgba(255,255,255,.70); }

    .envWrap{
      position:relative;
      margin: 8px auto 0;
      width: min(360px, 86vw);
      height: 310px;
    }
    .softShadow{
      position:absolute;
      left:50%; bottom: 12px;
      transform: translateX(-50%);
      width: 78%;
      height: 26px;
      background: radial-gradient(closest-side, rgba(0,0,0,.18), transparent 70%);
      filter: blur(2px);
      opacity:.55;
    }
    .letter{
      position:absolute;
      left:50%;
      top: 22px;
      transform: translateX(-50%);
      width: 86%;
      height: 205px;
      background: linear-gradient(180deg, #fffafc, #fff0f6);
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow2);
      padding: 18px 16px 16px;
      z-index: 2;
      transition: transform .75s var(--ease), top .75s var(--ease);
    }
    body.night .letter{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.12);
    }
    .letter::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: 12px;
      border: 1px dashed rgba(0,0,0,.10);
      pointer-events:none;
    }
    body.night .letter::before{ border: 1px dashed rgba(255,255,255,.20); }
    .letter h2{
      margin: 8px 0 10px;
      font-family: var(--serif);
      font-size: 18px;
      letter-spacing: -0.02em;
      color: rgba(42,31,36,.88);
    }
    body.night .letter h2{ color: rgba(255,255,255,.90); }
    .letter p{
      margin: 0;
      color: rgba(91,73,82,.88);
      font-size: 13.5px;
      line-height: 1.45;
      white-space: pre-line;
      min-height: 3.5em;
    }
    body.night .letter p{ color: rgba(255,255,255,.78); }

    .heartBtn{
      position:absolute;
      left:50%;
      bottom: 52px;
      transform: translateX(-50%);
      width: 68px;
      height: 60px;
      border: 0;
      cursor: pointer;
      background: transparent;
      z-index: 6;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.18));
      -webkit-tap-highlight-color: transparent;
    }
    .heart{
      width: 100%;
      height: 100%;
      position: relative;
      transform: rotate(-45deg);
      background: var(--rose2);
      border-radius: 10px;
      animation: heartPulse 1.1s var(--ease) infinite;
      animation-play-state: var(--animPlay);
    }
    .heart::before,
    .heart::after{
      content:"";
      position:absolute;
      width: 100%;
      height: 100%;
      background: var(--rose2);
      border-radius: 50%;
    }
    .heart::before{ top: -50%; left: 0; }
    .heart::after { left: 50%; top: 0; }
    @keyframes heartPulse{
      0%,100%{ transform: rotate(-45deg) scale(1); }
      50%    { transform: rotate(-45deg) scale(1.08); }
    }

    .envelope{
      position:absolute;
      left:50%;
      bottom: 0;
      transform: translateX(-50%);
      width: 92%;
      height: 190px;
      border-radius: 18px;
      background: linear-gradient(180deg, #f7a5bc, #f38aaa);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow2);
      z-index: 3;
      overflow:hidden;
    }
    body.night .envelope{
      background: linear-gradient(180deg, rgba(255,122,152,.45), rgba(225,23,79,.35));
      border: 1px solid rgba(255,255,255,.12);
    }
    .flapTop{
      position:absolute;
      left:0; right:0;
      top: 0;
      height: 0;
      border-left: 166px solid transparent;
      border-right: 166px solid transparent;
      border-top: 110px solid #fbd0dc;
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform .75s var(--ease);
      z-index: 5;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.10));
    }
    body.night .flapTop{ border-top-color: rgba(255,255,255,.18); }
    .flapLeft{
      position:absolute;
      left:0; bottom:0;
      width:0; height:0;
      border-right: 166px solid transparent;
      border-top: 95px solid rgba(255,255,255,.12);
      border-bottom: 95px solid rgba(0,0,0,.03);
      opacity:.45;
      z-index:4;
    }
    .flapRight{
      position:absolute;
      right:0; bottom:0;
      width:0; height:0;
      border-left: 166px solid transparent;
      border-top: 95px solid rgba(255,255,255,.10);
      border-bottom: 95px solid rgba(0,0,0,.02);
      opacity:.40;
      z-index:4;
    }
    .flapBottom{
      position:absolute;
      left:0; right:0;
      bottom:0;
      height:0;
      border-left: 166px solid transparent;
      border-right: 166px solid transparent;
      border-bottom: 110px solid rgba(255,255,255,.18);
      opacity:.55;
      z-index:4;
    }
    .seal{
      position:absolute;
      left: 22px;
      bottom: 16px;
      width: 64px;
      height: 64px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff2d55, #ff7a98);
      box-shadow: 0 14px 30px rgba(255,45,85,.25);
      display:grid;
      place-items:center;
      z-index: 6;
      transform: rotate(-6deg);
      opacity:.92;
      cursor: pointer;
      user-select:none;
    }
    .seal span{
      color:white;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .03em;
      user-select:none;
    }

    .introCard.opened .flapTop{ transform: rotateX(160deg); }
    .introCard.opened .letter{
      top: 6px;
      transform: translateX(-50%) translateY(-18px);
    }

    .introHint{
      margin-top: 14px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.85);
      color: rgba(42,31,36,.70);
      font-weight: 800;
      font-size: 13px;
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      user-select:none;
    }
    body.night .introHint{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.75);
    }

    /* =========================
       REVISTA / PÃGINAS
    ========================== */
    .app{
      height:100%;
      display:grid;
      place-items:center;
      padding: 18px;
    }

    .mag{
      width: min(560px, 94vw);
      height: min(980px, 92vh);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.52));
      border: 1px solid rgba(255,255,255,.85);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
      --mx: 50%;
      --my: 30%;
      touch-action: pan-y;

      perspective: 1200px;
      transform-style: preserve-3d;
    }
    body.night .mag{
      background: linear-gradient(180deg, rgba(20,12,18,.62), rgba(20,12,18,.45));
      border: 1px solid rgba(255,255,255,.12);
    }

    .mag::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 700px at 30% 10%, rgba(225,23,79,.08), transparent 65%),
        radial-gradient(1200px 700px at 80% 30%, rgba(255,255,255,.55), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.20), rgba(0,0,0,.02));
      opacity:.95;
      pointer-events:none;
    }
    body.night .mag::before{
      opacity:.55;
      background:
        radial-gradient(1200px 700px at 30% 10%, rgba(255,45,107,.12), transparent 65%),
        radial-gradient(1200px 700px at 80% 30%, rgba(255,255,255,.08), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.04));
    }

    .mag::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(400px 260px at var(--mx) var(--my),
        rgba(255,255,255,.35), transparent 60%);
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.55;
    }
    body.night .mag::after{ opacity:.38; }

    .pages{ position:absolute; inset:0; }

    .page{
      position:absolute; inset:0;
      padding: 18px 18px 92px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      opacity:0;
      pointer-events:none;

      transform-origin: 50% 50%;
      backface-visibility: hidden;
      will-change: transform, opacity;
    }
    .page.active{
      opacity:1;
      pointer-events:auto;
    }

    .page.flip-in-right{ animation: flipInRight .55s var(--ease) both; }
    .page.flip-out-left{ animation: flipOutLeft .45s var(--ease) both; }
    .page.flip-in-left{ animation: flipInLeft .55s var(--ease) both; }
    .page.flip-out-right{ animation: flipOutRight .45s var(--ease) both; }

    @keyframes flipInRight{
      from{ opacity:0; transform: translate3d(20px,0,0) rotateY(-26deg) scale(.99); }
      to  { opacity:1; transform: translate3d(0,0,0) rotateY(0deg) scale(1); }
    }
    @keyframes flipOutLeft{
      from{ opacity:1; transform: translate3d(0,0,0) rotateY(0deg); }
      to  { opacity:0; transform: translate3d(-16px,0,0) rotateY(22deg); }
    }
    @keyframes flipInLeft{
      from{ opacity:0; transform: translate3d(-20px,0,0) rotateY(26deg) scale(.99); }
      to  { opacity:1; transform: translate3d(0,0,0) rotateY(0deg) scale(1); }
    }
    @keyframes flipOutRight{
      from{ opacity:1; transform: translate3d(0,0,0) rotateY(0deg); }
      to  { opacity:0; transform: translate3d(16px,0,0) rotateY(-22deg); }
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size: 12px;
      color: rgba(42,31,36,.62);
      letter-spacing: .08em;
      text-transform: uppercase;
    }
    body.night .topline{ color: rgba(255,255,255,.60); }

    .rule{
      height:2px;
      background: var(--line);
      margin: 10px 0 10px;
      opacity:.65;
    }
    .rule.thin{
      height:1px;
      opacity:.45;
      background: var(--line2);
    }

    .masthead{
      text-align:center;
      font-family: var(--serif);
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--rose);
      font-size: 46px;
      line-height: 1;
      margin: 8px 0 8px;
    }
    body.night .masthead{ color: rgba(255,122,152,.95); }

    .subhead-row{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      font-size: 12.5px;
      color: rgba(42,31,36,.70);
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 0 4px;
    }
    body.night .subhead-row{ color: rgba(255,255,255,.68); }

    .bigQuestion{
      text-align:center;
      margin: 22px 0 10px;
      font-family: var(--serif);
      color: rgba(225,23,79,.92);
    }
    body.night .bigQuestion{ color: rgba(255,122,152,.95); }
    .bigQuestion .small{
      font-size: 24px;
      letter-spacing: .06em;
      text-transform: uppercase;
    }
    .bigQuestion .script{
      font-size: 52px;
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1;
    }

    .centerNote{
      text-align:center;
      margin: 16px 0 18px;
      color: rgba(42,31,36,.70);
      font-family: var(--serif);
      letter-spacing: .02em;
    }
    body.night .centerNote{ color: rgba(255,255,255,.70); }

    .columns{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 520px){ .columns{ grid-template-columns: 1fr; } }

    .article{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(225,23,79,.18);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }
    body.night .article{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .article .kicker{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      font-family: var(--serif);
      font-style: italic;
      color: rgba(42,31,36,.72);
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(225,23,79,.18);
      padding-bottom: 8px;
    }
    body.night .article .kicker{
      color: rgba(255,255,255,.70);
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .article p{
      margin:0;
      font-family: var(--serif);
      color: rgba(42,31,36,.78);
      line-height: 1.55;
      font-size: 15px;
      white-space: pre-line;
    }
    body.night .article p{ color: rgba(255,255,255,.76); }

    .photo{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(225,23,79,.18);
      border-radius: 16px;
      padding: 10px;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }
    body.night .photo{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }

    .frame{
      width:100%;
      aspect-ratio: 1 / 1.2;
      border-radius: 12px;
      background:
        radial-gradient(240px 180px at 30% 25%, rgba(225,23,79,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,.35));
      border: 1px solid rgba(225,23,79,.20);
      display:grid;
      place-items:center;
      overflow:hidden;
      position:relative;
    }

    .frame.loading::after{
      content:"";
      position:absolute; inset:-40%;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(255,255,255,.45) 20%,
        transparent 40%);
      opacity:.55;
      transform: translateX(-40%);
      animation: shimmer 1.2s linear infinite;
      animation-play-state: var(--animPlay);
      pointer-events:none;
    }
    @keyframes shimmer{
      to{ transform: translateX(60%); }
    }
    body.night .frame.loading::after{ opacity:.22; }

    .frame img{
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(1.02);
      transition: transform .55s var(--ease);
      will-change: transform;
      filter: saturate(1.05) contrast(1.03);
      opacity: 0;
      transition: opacity .35s var(--ease), transform .55s var(--ease);
    }
    .frame.loaded img{ opacity:1; }
    .frame:hover img{ transform: scale(1.06); }
    @media (hover: none){
      .frame:hover img{ transform: scale(1.02); }
    }

    .overlayBtn{
      margin-top: 10px;
      display:block;
      width:100%;
      border-radius: 999px;
      border: 2px solid rgba(225,23,79,.55);
      background: rgba(255,255,255,.45);
      color: rgba(225,23,79,.92);
      font-weight: 900;
      padding: 10px 12px;
      text-align:center;
      letter-spacing: .02em;
      user-select:none;
      transition: transform .15s var(--ease), filter .15s var(--ease);
    }
    .overlayBtn:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .overlayBtn:active{ transform: translateY(0); }
    body.night .overlayBtn{
      background: rgba(255,255,255,.08);
      border: 2px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.90);
    }

    .tickets{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items:stretch;
    }
    @media (max-width: 520px){ .tickets{ grid-template-columns: 1fr; } }
    .ticket{
      border-radius: 18px;
      border: 1px solid rgba(225,23,79,.25);
      background: rgba(255,255,255,.60);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      overflow:hidden;
      display:flex;
      min-height: 86px;
      transition: transform .15s var(--ease);
    }
    .ticket:hover{ transform: translateY(-2px); }
    .ticket:active{ transform: translateY(-1px); }
    body.night .ticket{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .ticket .stub{
      width: 78px;
      background: linear-gradient(180deg, rgba(225,23,79,.95), rgba(255,45,107,.85));
      color: rgba(255,255,255,.95);
      padding: 10px 8px;
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      text-align:center;
      position:relative;
    }
    body.night .ticket .stub{
      background: linear-gradient(180deg, rgba(255,45,107,.78), rgba(225,23,79,.62));
    }
    .ticket .body{
      flex:1;
      padding: 12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 6px;
    }
    .ticket .body .label{
      color: rgba(42,31,36,.62);
      font-weight: 800;
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 11px;
    }
    body.night .ticket .body .label{ color: rgba(255,255,255,.62); }
    .ticket .body .value{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      font-size: 18px;
      letter-spacing: -0.01em;
    }
    body.night .ticket .body .value{ color: rgba(255,122,152,.95); }

    /* =========================
       PAGE 2: RAZONES + SEÃ‘ALES
    ========================== */
    .p2Header{
      text-align:center;
      margin: 8px 0 10px;
      padding: 0 6px;
    }
    .p2Header .t1{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.95);
      font-size: 52px;
      line-height: 1;
      letter-spacing: -0.02em;
    }
    body.night .p2Header .t1{ color: rgba(255,122,152,.95); }
    .p2Header .t1 .num{ font-variant-numeric: tabular-nums; }
    .p2Header .t2{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.95);
      font-size: 34px;
      line-height: 1.05;
      letter-spacing: -0.02em;
      margin-top: 2px;
    }
    body.night .p2Header .t2{ color: rgba(255,122,152,.92); }
    .p2Header .t3{
      font-family: var(--script);
      font-weight: 900;
      color: rgba(225,23,79,.78);
      font-size: 46px;
      line-height: 1.05;
      margin-top: -2px;
      letter-spacing: -0.01em;
    }
    body.night .p2Header .t3{ color: rgba(255,255,255,.70); }

    .matrixWrap{
      margin-top: 6px;
      border-radius: 18px;
      background:
        radial-gradient(900px 420px at 50% 25%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border: 1px solid rgba(225,23,79,.18);
      padding: 8px 8px 10px;
      box-shadow: 0 12px 28px rgba(0,0,0,.06);
      position:relative;
      overflow:hidden;
    }
    body.night .matrixWrap{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
    }

    .matrixWrap::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(2px 2px at 10% 30%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(2px 2px at 30% 55%, rgba(255,255,255,.75), transparent 60%),
        radial-gradient(2px 2px at 70% 25%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(2px 2px at 85% 60%, rgba(255,255,255,.75), transparent 60%),
        radial-gradient(2px 2px at 55% 78%, rgba(255,255,255,.70), transparent 60%);
      opacity:.55;
      animation: twinkle 3.2s var(--ease2) infinite alternate;
      animation-play-state: var(--animPlay);
      pointer-events:none;
    }
    body.night .matrixWrap::before{ opacity:.25; }
    @keyframes twinkle{
      from{ transform: translate3d(-1.5%, -1%, 0) scale(1); opacity:.45; }
      to  { transform: translate3d( 1.5%,  1%, 0) scale(1.02); opacity:.65; }
    }

    .matrix{
      position:relative;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 0;
      border-radius: 14px;
      overflow:hidden;
      min-height: 380px;
    }
    @media (max-width:520px){ .matrix{ min-height: 430px; } }

    .cell{
      position:relative;
      display:grid;
      place-items:center;
      padding: 10px 8px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(225,23,79,.55);
    }
    body.night .cell{
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.18);
    }
    .cell.r1{ border-top: 0; }
    .cell.r3{ border-bottom: 0; }
    .cell.c1{ border-left: 0; }
    .cell.c3{ border-right: 0; }

    .reasonBlock{
      width: 100%;
      max-width: 200px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(225,23,79,.92);
      line-height: 1.28;
      font-size: 14px;
      white-space: pre-line;
      position:relative;
      z-index:2;
    }
    body.night .reasonBlock{ color: rgba(255,122,152,.92); }

    .reasonBlock .n{
      position:absolute;
      top: -8px;
      left: -4px;
      font-size: 28px;
      font-weight: 900;
      color: rgba(225,23,79,.95);
      transform: rotate(-2deg);
      text-shadow: 0 10px 18px rgba(0,0,0,.08);
    }
    body.night .reasonBlock .n{ color: rgba(255,122,152,.95); }
    .reasonBlock .txt{ display:block; padding-top: 16px; }

    .bigHeart{
      font-size: 44px;
      line-height: 1;
      filter: drop-shadow(0 16px 20px rgba(225,23,79,.18));
      animation: heartFloat 2.3s var(--ease2) infinite alternate;
      animation-play-state: var(--animPlay);
      user-select:none;
      z-index:2;
    }
    @keyframes heartFloat{
      from{ transform: translateY(3px) scale(1); }
      to  { transform: translateY(-3px) scale(1.03); }
    }

    .signals2{
      margin-top: 14px;
      text-align:center;
      padding: 6px 2px 0;
    }
    .signals2 .k{
      font-family: var(--serif);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-weight: 900;
      color: rgba(42,31,36,.55);
      font-size: 12px;
      margin-bottom: 6px;
    }
    body.night .signals2 .k{ color: rgba(255,255,255,.58); }
    .signals2 .big{
      font-family: var(--serif);
      font-weight: 1000;
      color: rgba(225,23,79,.95);
      font-size: 36px;
      letter-spacing: -0.02em;
      margin-bottom: 4px;
    }
    body.night .signals2 .big{ color: rgba(255,122,152,.95); }
    .signals2 .sub{
      font-family: var(--serif);
      color: rgba(42,31,36,.65);
      font-size: 14px;
      margin-bottom: 10px;
    }
    body.night .signals2 .sub{ color: rgba(255,255,255,.68); }
    .signalsGrid2{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    @media (max-width:520px){ .signalsGrid2{ grid-template-columns: 1fr; } }
    .signalBox{
      border-radius: 14px;
      background: rgba(225,23,79,.96);
      color: rgba(255,255,255,.96);
      font-family: var(--serif);
      padding: 14px 12px;
      font-size: 14px;
      line-height: 1.35;
      box-shadow: 0 16px 34px rgba(225,23,79,.20);
      transform: translateY(8px);
      opacity:0;
      animation: sigIn .55s var(--ease) forwards;
      animation-play-state: var(--animPlay);
    }
    body.night .signalBox{
      background: rgba(255,45,107,.72);
      box-shadow: 0 16px 34px rgba(0,0,0,.22);
    }
    .signalBox:nth-child(1){ animation-delay:.05s; }
    .signalBox:nth-child(2){ animation-delay:.11s; }
    .signalBox:nth-child(3){ animation-delay:.17s; }
    @keyframes sigIn{ to{ transform: translateY(0); opacity:1; } }

    /* =========================
       PAGE 3: GALERÃA POLAROIDS
    ========================== */
    .galleryTitle{
      text-align:center;
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.95);
      margin: 10px 0 4px;
      font-size: 34px;
      letter-spacing: -0.02em;
    }
    body.night .galleryTitle{ color: rgba(255,122,152,.95); }
    .gallerySub{
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.70);
      margin: 0 0 14px;
      font-size: 15px;
    }
    body.night .gallerySub{ color: rgba(255,255,255,.70); }

    .polaroids{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-top: 10px;
    }
    @media (max-width:520px){ .polaroids{ grid-template-columns: 1fr; } }

    .polaroid{
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(225,23,79,.18);
      border-radius: 18px;
      box-shadow: 0 16px 34px rgba(0,0,0,.08);
      padding: 12px;
      position:relative;
      transform: rotate(var(--rot));
      transition: transform .25s var(--ease), box-shadow .25s var(--ease);
      cursor: pointer;
      overflow:hidden;
      user-select:none;
    }
    body.night .polaroid{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 34px rgba(0,0,0,.22);
    }
    .polaroid:hover{
      transform: rotate(var(--rot)) translateY(-2px);
      box-shadow: 0 20px 42px rgba(0,0,0,.10);
    }
    .polaroid:active{ transform: rotate(var(--rot)) translateY(-1px) scale(.995); }

    .polaroid .pic{
      width:100%;
      aspect-ratio: 4 / 3;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(225,23,79,.20);
      background:
        radial-gradient(240px 180px at 30% 25%, rgba(225,23,79,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,.35));
      position:relative;
    }
    body.night .polaroid .pic{ border: 1px solid rgba(255,255,255,.12); }

    .polaroid img{
      width:100%; height:100%;
      object-fit: cover;
      transform: scale(1.02);
      filter: saturate(1.06) contrast(1.02);
      transition: transform .55s var(--ease);
    }
    .polaroid:hover img{ transform: scale(1.06); }

    .polaroid .cap{
      margin-top: 10px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.78);
      font-size: 14px;
      letter-spacing: .01em;
    }
    body.night .polaroid .cap{ color: rgba(255,255,255,.78); }

    /* Modal zoom */
    .modal{
      position: fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      place-items:center;
      z-index: 120;
      padding: 16px;
    }
    .modal.show{ display:grid; }
    .modalCard{
      width: min(920px, 95vw);
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.50);
      box-shadow: 0 26px 80px rgba(0,0,0,.28);
      overflow:hidden;
      transform: scale(.98);
      animation: modalIn .18s var(--ease) both;
    }
    body.night .modalCard{
      background: rgba(18,10,16,.92);
      border: 1px solid rgba(255,255,255,.12);
    }
    @keyframes modalIn{ to{ transform: scale(1); } }

    .modalTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(225,23,79,.14);
      background: rgba(255,255,255,.65);
    }
    body.night .modalTop{
      background: rgba(255,255,255,.06);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalTop .t{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      letter-spacing: -0.01em;
    }
    body.night .modalTop .t{ color: rgba(255,122,152,.95); }
    .modalTop button{
      border: 0;
      background: rgba(20,20,25,.12);
      color: rgba(20,20,25,.82);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
    }
    body.night .modalTop button{
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.90);
    }

    .modalImgWrap{
      width: 100%;
      background: rgba(0,0,0,.04);
    }
    .modalImg{
      width:100%;
      height: min(72vh, 680px);
      object-fit: contain;
      display:block;
      background: rgba(0,0,0,.08);
    }

    /* =========================
       PAGE 4: PREGUNTA
    ========================== */
    .grand{
      text-align:center;
      font-family: var(--serif);
      color: rgba(225,23,79,.95);
      margin: 14px 0 10px;
      font-weight: 900;
      font-size: 34px;
      letter-spacing: -0.02em;
    }
    body.night .grand{ color: rgba(255,122,152,.95); }
    .paragraph{
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.72);
      line-height: 1.6;
      margin: 0 10px;
      font-size: 16px;
      white-space: pre-line;
    }
    body.night .paragraph{ color: rgba(255,255,255,.70); }
    .bigAsk{
      margin: 12px 0 8px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(225,23,79,.95);
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: 1.05;
    }
    body.night .bigAsk{ color: rgba(255,122,152,.95); }
    .bigAsk .top{ font-size: 34px; }
    .bigAsk .bottom{ font-size: 40px; font-style: italic; }
    .ask{
      margin-top: 10px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.70);
      font-size: 16px;
      letter-spacing: .02em;
    }
    body.night .ask{ color: rgba(255,255,255,.68); }

    .btnStage{
      margin: 16px auto 0;
      width: min(480px, 94%);
      height: 110px;
      border-radius: 18px;
      background: rgba(255,255,255,.38);
      border: 1px solid rgba(225,23,79,.18);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.40);
      position:relative;
      overflow:hidden;
      display:grid;
      place-items:center;
      touch-action: manipulation;
    }
    body.night .btnStage{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .choice{
      position:absolute;
      min-width: 170px;
      padding: 14px 16px;
      border-radius: 999px;
      border: 2px solid rgba(225,23,79,.58);
      background: rgba(255,255,255,.58);
      color: rgba(225,23,79,.95);
      font-weight: 900;
      letter-spacing: .02em;
      box-shadow: 0 14px 28px rgba(0,0,0,.08);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      transition: transform .15s var(--ease), filter .15s var(--ease);
    }
    .choice:hover{ transform: translate(var(--tx), var(--ty)) translateY(-1px); filter: brightness(1.03); }
    .choice:active{ transform: translate(var(--tx), var(--ty)) scale(.985); }
    body.night .choice{
      background: rgba(255,255,255,.08);
      border: 2px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.90);
      box-shadow: 0 14px 28px rgba(0,0,0,.22);
    }

    .choice.yes{
      z-index: 6;
      left: 50%;
      top: 50%;
      --tx: -112%;
      --ty: -50%;
      transform: translate(-112%, -50%);
    }
    .choice.no{
      z-index: 5;
      border: 0;
      background: rgba(20,20,25,.78);
      color: rgba(255,255,255,.94);
      box-shadow: 0 14px 28px rgba(0,0,0,.12);
      min-width: 120px;
      left: 50%;
      top: 50%;
      transform: translate(12%, -50%);
      will-change: left, top, transform;
    }
    body.night .choice.no{
      background: rgba(0,0,0,.55);
      box-shadow: 0 14px 28px rgba(0,0,0,.28);
    }

    /* =========================
       PAGE 5: FINAL
    ========================== */
    .final{
      height: calc(100% - 0px);
      display:grid;
      place-items:center;
      padding-top: 18px;
    }
    .finalCard{
      width: min(460px, 92%);
      border-radius: 24px;
      background: rgba(225,23,79,.88);
      color: rgba(255,255,255,.95);
      box-shadow: 0 22px 60px rgba(225,23,79,.22);
      border: 1px solid rgba(255,255,255,.18);
      padding: 20px 16px 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    body.night .finalCard{
      background: rgba(255,45,107,.55);
      box-shadow: 0 22px 60px rgba(0,0,0,.32);
      border: 1px solid rgba(255,255,255,.12);
    }
    .finalCard::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(520px 360px at 20% 20%, rgba(255,255,255,.18), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .finalCard h2{
      margin: 6px 0 14px;
      font-family: var(--serif);
      font-size: 36px;
      font-weight: 900;
      letter-spacing: -0.02em;
      position:relative;
    }
    .lace{
      width: 220px;
      height: 160px;
      margin: 0 auto 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:relative;
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
      overflow:hidden;
    }
    body.night .lace{
      background: rgba(255,255,255,.10);
      box-shadow: 0 18px 40px rgba(0,0,0,.28);
    }
    .lace::before{
      content:"";
      position:absolute; inset:10px;
      border-radius: 999px;
      border: 2px dashed rgba(225,23,79,.35);
    }
    body.night .lace::before{ border: 2px dashed rgba(255,255,255,.18); }
    .lace .txt{
      position:absolute; inset:0;
      display:grid; place-items:center;
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      font-size: 26px;
      letter-spacing: -0.02em;
      padding: 0 12px;
      text-align:center;
    }
    body.night .lace .txt{ color: rgba(255,255,255,.92); }

    .initials{
      display:flex; justify-content:center; gap:10px;
      margin-top: -12px; position:relative;
    }
    .init{
      width: 58px; height: 44px;
      border-radius: 14px;
      background: rgba(255,255,255,.92);
      color: rgba(225,23,79,.92);
      font-weight: 1000;
      display:grid; place-items:center;
      box-shadow: 0 14px 30px rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.55);
      font-family: var(--serif);
      font-size: 22px;
    }
    body.night .init{
      background: rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 30px rgba(0,0,0,.28);
    }
    .finalCard p{
      margin: 14px 0 0;
      position:relative;
      font-family: var(--serif);
      font-size: 16px;
      line-height: 1.55;
      opacity:.95;
      white-space: pre-line;
    }

    .finalGlow{
      position:absolute; inset:-20%;
      background:
        radial-gradient(700px 420px at 50% 35%, rgba(255,255,255,.14), transparent 60%),
        radial-gradient(700px 420px at 30% 70%, rgba(255,255,255,.10), transparent 65%);
      opacity:0;
      pointer-events:none;
    }
    .finalOn .finalGlow{
      animation: glowIn 1.2s var(--ease) both;
      animation-play-state: var(--animPlay);
    }
    @keyframes glowIn{
      0%{ opacity:0; transform: scale(.98); }
      100%{ opacity:1; transform: scale(1.02); }
    }

    /* =========================
       CORAZONES PRO
    ========================== */
    .heartFXPro{
      position: fixed;
      z-index: 80;
      pointer-events:none;
      will-change: transform, opacity;
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.25));
      animation: flyPro var(--dur) var(--ease) forwards;
      animation-play-state: var(--animPlay);
      opacity: 0;
      transform: translate3d(0,0,0) rotate(0deg) scale(1);
    }
    @keyframes flyPro{
      0%{ opacity:0; transform: translate3d(0,0,0) rotate(0deg) scale(.85); }
      12%{ opacity:1; transform: translate3d(0,-10px,0) rotate(0deg) scale(1); }
      100%{ opacity:0; transform: translate3d(var(--dx), var(--dy), 0) rotate(var(--rot)) scale(.95); }
    }

    .miniFooter{
      text-align:center;
      margin-top: 14px;
      font-size: 11px;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: rgba(42,31,36,.45);
      opacity:.8;
    }
    body.night .miniFooter{ color: rgba(255,255,255,.40); }

    /* =========================
       NAV + PROGRESO + TOGGLES
    ========================== */
    .nav{
      position:absolute;
      left:0; right:0; bottom:0;
      padding: 10px 12px 12px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(to top, rgba(255,255,255,.80), rgba(255,255,255,0));
      backdrop-filter: blur(6px);
      border-top: 1px solid rgba(225,23,79,.10);
      z-index: 10;
      flex-wrap: wrap;
      align-items:center;
    }
    body.night .nav{
      background: linear-gradient(to top, rgba(10,8,10,.72), rgba(10,8,10,0));
      border-top: 1px solid rgba(255,255,255,.10);
    }

    .navMain{
      display:flex;
      gap: 10px;
      flex: 1 1 320px;
      align-items:center;
    }

    .nav button{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(225,23,79,.35);
      background: rgba(255,255,255,.60);
      color: rgba(225,23,79,.92);
      font-weight: 900;
      letter-spacing: .03em;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.06);
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s var(--ease), opacity .2s var(--ease), filter .2s var(--ease);
      user-select:none;
    }
    .nav button:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .nav button:active{ transform: scale(.985); }
    .nav button[disabled]{ opacity:.40; cursor:not-allowed; }
    .nav button.hidden{
      opacity:0;
      pointer-events:none;
      transform: translateY(6px);
    }
    body.night .nav button{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
      box-shadow: 0 12px 24px rgba(0,0,0,.22);
    }

    #prev, #next{ flex: 1 1 150px; max-width: 220px; }

    .navChips{
      display:flex;
      gap: 8px;
      flex: 0 0 auto;
      align-items:center;
      justify-content:flex-end;
    }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(225,23,79,.22);
      background: rgba(255,255,255,.55);
      font-weight: 900;
      letter-spacing: .02em;
      font-size: 12px;
      color: rgba(42,31,36,.72);
      box-shadow: 0 12px 24px rgba(0,0,0,.06);
      cursor:pointer;
    }
    body.night .chip{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.85);
      box-shadow: 0 12px 24px rgba(0,0,0,.22);
    }

    .progressWrap{
      width: 100%;
      margin-top: 8px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pageLabel{
      font-family: var(--serif);
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(42,31,36,.62);
      min-width: 74px;
      text-align:center;
    }
    body.night .pageLabel{ color: rgba(255,255,255,.62); }
    .bar{
      flex:1;
      height: 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.06);
      overflow:hidden;
      border: 1px solid rgba(225,23,79,.18);
    }
    body.night .bar{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .bar > span{
      display:block;
      height: 100%;
      width: var(--prog);
      background: linear-gradient(90deg, rgba(225,23,79,.85), rgba(255,45,107,.70));
      border-radius: 999px;
      transition: width .35s var(--ease);
    }

    /* =========================
       CupÃ³n descargable (Canvas)
    ========================== */
    .couponBox{
      margin: 16px auto 0;
      width: min(520px, 95%);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(225,23,79,.18);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      padding: 12px;
      text-align:center;
    }
    body.night .couponBox{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .couponBox .t{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      font-size: 18px;
      margin: 4px 0 10px;
    }
    body.night .couponBox .t{ color: rgba(255,122,152,.95); }
    .couponRow{
      display:flex;
      gap: 10px;
      justify-content:center;
      flex-wrap: wrap;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(10px);
      background: rgba(20,20,25,.88);
      color: rgba(255,255,255,.96);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing: .02em;
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      z-index: 140;
      transition: opacity .18s var(--ease), transform .18s var(--ease);
      box-shadow: 0 16px 34px rgba(0,0,0,.22);
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0px);
    }
  </style>
</head>

<body>
  <!-- âœ… AUDIO: mÃºsica de fondo -->
  <audio id="bgMusic" preload="auto" loop>
    <source src="Stuck%20with%20you.mp3" type="audio/mpeg">
  </audio>

  <!-- âœ… SFX (opcional): si no tienes estos archivos, no pasa nada -->
  <audio id="sfxPage" preload="auto">
    <source src="page.mp3" type="audio/mpeg">
  </audio>
  <audio id="sfxPop" preload="auto">
    <source src="pop.mp3" type="audio/mpeg">
  </audio>

  <div class="bg-aurora"></div>
  <div class="bg-grain"></div>
  <div class="petals" id="petals" aria-hidden="true"></div>

  <!-- Modal zoom galerÃ­a -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-label="Vista de foto">
      <div class="modalTop">
        <div class="t" id="modalTitle">ðŸ’—</div>
        <button id="closeModal" type="button" aria-label="Cerrar">Cerrar âœ•</button>
      </div>
      <div class="modalImgWrap">
        <img class="modalImg" id="modalImg" alt="Foto ampliada">
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Listo âœ¨</div>

  <!-- INTRO -->
  <section class="intro" id="intro" aria-label="Inicio con carta">
    <div class="introCard" id="introCard">
      <div class="introTitle">Te tengo una sorpresaâ€¦ ðŸ’Œ</div>
      <div class="introSub">Para descubrirla, toca el corazÃ³n</div>

      <div class="envWrap">
        <div class="letter" id="letter">
          <h2>Para ti ðŸ’—</h2>
          <p id="letterText" aria-live="polite"></p>
        </div>

        <button class="heartBtn" id="heartBtn" aria-label="Abrir sobre">
          <div class="heart"></div>
        </button>

        <div class="envelope" aria-hidden="true">
          <div class="flapTop" id="flap"></div>
          <div class="flapLeft"></div>
          <div class="flapRight"></div>
          <div class="flapBottom"></div>
          <div class="seal" id="seal"><span>LOVE</span></div>
        </div>

        <div class="softShadow"></div>
      </div>

      <div class="introHint" id="introHint">âœ¨ Se abre con amor</div>
    </div>
  </section>

  <!-- REVISTA -->
  <div class="app">
    <div class="mag" role="application" aria-label="Valentine Edition">
      <div class="pages">

        <!-- PAGE 1 -->
        <section class="page active" data-page="0" aria-label="Portada">
          <div class="topline">
            <span>EdiciÃ³n especial</span>
            <span>Valentine</span>
            <span>Febrero</span>
          </div>

          <div class="masthead">Valentine Edition</div>
          <div class="rule"></div>

          <div class="subhead-row">
            <span>14 de febrero</span>
            <span>Me gustas mucho</span>
            <span>Juntos por siempre</span>
          </div>

          <div class="rule thin"></div>

          <div class="bigQuestion">
            <div class="small">Will you be my</div>
            <div class="script">Valentine?</div>
          </div>

          <div class="centerNote">
            DistribuciÃ³n: <b>exclusiva</b> para la persona mÃ¡s especial ðŸ’—
          </div>

          <div class="columns">
            <div class="article">
              <div class="kicker">
                <span>Diario de amor</span>
                <span>San Valentine</span>
              </div>
              <p>
DespuÃ©s de que el mundo hiciera su magia y los caminos se cruzaran,
quedÃ³ claro algo: quiero vivir este 14 de febrero contigo.

Mi corazÃ³n â€”la Ãºnica fuente confiable en estos temasâ€” lo tiene claro desde hace tiempo.

Quiero un San ValentÃ­n a tu lado, lleno de amor, risas sinceras
y momentos que se queden grabados.
              </p>
            </div>

            <div class="photo">
              <div class="frame loading" id="mainFrame" aria-label="Foto de nosotros">
                <img id="mainPhoto" src="foto.jpg.jpeg" alt="Nuestra foto" loading="eager" decoding="async">
              </div>
              <div class="overlayBtn">Â¿Aceptas la misiÃ³n de ser mi San ValentÃ­n?</div>
            </div>
          </div>

          <div class="tickets">
            <div class="ticket">
              <div class="stub">San ValentÃ­n</div>
              <div class="body">
                <div class="label">CupÃ³n para:</div>
                <div class="value">Una cita sorpresa âœ¨</div>
              </div>
            </div>
            <div class="ticket">
              <div class="stub">San ValentÃ­n</div>
              <div class="body">
                <div class="label">CupÃ³n para:</div>
                <div class="value">Una ida al cine ðŸŽ¬</div>
              </div>
            </div>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 2 -->
        <section class="page" data-page="1" aria-label="Razones">
          <div class="topline">
            <span>EdiciÃ³n especial</span>
            <span>Me gustas mucho</span>
            <span>Juntos por siempre</span>
          </div>
          <div class="rule"></div>

          <div class="p2Header">
            <div class="t1"><span class="num">5</span> Razones</div>
            <div class="t2">por las que eres</div>
            <div class="t3">Mi elecciÃ³n perfecta</div>
          </div>

          <div class="matrixWrap">
            <div class="matrix" aria-label="Matriz de 5 razones">
              <div class="cell r1 c1">
                <div class="reasonBlock">
                  <div class="n">1</div>
                  <span class="txt">Tienes la sonrisa<br>mÃ¡s linda<br>del universo.</span>
                </div>
              </div>
              <div class="cell r1 c2">
                <div class="bigHeart">â¤ï¸</div>
              </div>
              <div class="cell r1 c3">
                <div class="reasonBlock">
                  <div class="n">3</div>
                  <span class="txt">Contigo,<br>cualquier dÃ­a se<br>siente especial.</span>
                </div>
              </div>

              <div class="cell r2 c1">
                <div class="bigHeart">â¤ï¸</div>
              </div>
              <div class="cell r2 c2">
                <div class="reasonBlock">
                  <div class="n">2</div>
                  <span class="txt">Haces que mi<br>corazÃ³n lata<br>mÃ¡s rÃ¡pido<br>cada vez que<br>te pienso</span>
                </div>
              </div>
              <div class="cell r2 c3">
                <div class="bigHeart">â¤ï¸</div>
              </div>

              <div class="cell r3 c1">
                <div class="reasonBlock">
                  <div class="n">4</div>
                  <span class="txt">Eres mi<br>persona<br>favorita<br>para<br>compartir<br>momentos.</span>
                </div>
              </div>
              <div class="cell r3 c2">
                <div class="bigHeart">â¤ï¸</div>
              </div>
              <div class="cell r3 c3">
                <div class="reasonBlock">
                  <div class="n">5</div>
                  <span class="txt">No imagino<br>a nadie<br>mÃ¡s a mi<br>lado en<br>este San<br>ValentÃ­n</span>
                </div>
              </div>
            </div>
          </div>

          <div class="signals2">
            <div class="k">SEÃ‘ALES DE QUE</div>
            <div class="big">Debes decir â€œSÃ­â€</div>
            <div class="sub">Estudios recientes han demostrado que:</div>

            <div class="signalsGrid2">
              <div class="signalBox">Si estÃ¡s leyendo esto, significa que el destino nos ha unido.</div>
              <div class="signalBox">Si has sonreÃ­do al menos una vez, es una seÃ±al obvia.</div>
              <div class="signalBox">Si te gusta el romance, somos un match perfecto.</div>
            </div>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 3 -->
        <section class="page" data-page="2" aria-label="GalerÃ­a">
          <div class="topline">
            <span>EdiciÃ³n especial</span>
            <span>Recuerdos</span>
            <span>ðŸ’ž</span>
          </div>
          <div class="rule"></div>

          <div class="galleryTitle">Mini galerÃ­a</div>
          <div class="gallerySub">Toca una polaroid para verla en grande âœ¨</div>

          <div class="polaroids" id="polaroids">
            <div class="polaroid" style="--rot:-2.4deg" data-src="Foto%201.jpeg" data-title="Foto 1 ðŸ’—">
              <div class="pic"><img src="Foto%201.jpeg" alt="Foto 1" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 1 ðŸ’—</div>
            </div>
            <div class="polaroid" style="--rot:1.7deg" data-src="Foto%202.jpeg" data-title="Foto 2 ðŸ’—">
              <div class="pic"><img src="Foto%202.jpeg" alt="Foto 2" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 2 ðŸ’—</div>
            </div>
            <div class="polaroid" style="--rot:2.2deg" data-src="Foto%203.jpeg" data-title="Foto 3 âœ¨">
              <div class="pic"><img src="Foto%203.jpeg" alt="Foto 3" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 3 âœ¨</div>
            </div>
            <div class="polaroid" style="--rot:-1.3deg" data-src="Foto%204.jpeg" data-title="Foto 4 ðŸ«¶">
              <div class="pic"><img src="Foto%204.jpeg" alt="Foto 4" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 4 ðŸ«¶</div>
            </div>
            <div class="polaroid" style="--rot:1.2deg" data-src="Foto%205.jpeg" data-title="Foto 5 ðŸ’ž">
              <div class="pic"><img src="Foto%205.jpeg" alt="Foto 5" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 5 ðŸ’ž</div>
            </div>
            <div class="polaroid" style="--rot:-2.0deg" data-src="Foto%206.jpeg" data-title="Foto 6 âœ¨">
              <div class="pic"><img src="Foto%206.jpeg" alt="Foto 6" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 6 âœ¨</div>
            </div>
            <div class="polaroid" style="--rot:2.6deg" data-src="Foto%207.jpeg" data-title="Foto 7 ðŸ—ºï¸">
              <div class="pic"><img src="Foto%207.jpeg" alt="Foto 7" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 7 ðŸ—ºï¸</div>
            </div>
            <div class="polaroid" style="--rot:-1.6deg" data-src="Foto%208.jpeg" data-title="Foto 8 ðŸ«¶">
              <div class="pic"><img src="Foto%208.jpeg" alt="Foto 8" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 8 ðŸ«¶</div>
            </div>
            <div class="polaroid" style="--rot:1.9deg" data-src="Foto%209.jpeg" data-title="Foto 9 ðŸ¥°">
              <div class="pic"><img src="Foto%209.jpeg" alt="Foto 9" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 9 ðŸ¥°</div>
            </div>
            <div class="polaroid" style="--rot:-2.2deg" data-src="Foto%2010.jpeg" data-title="Foto 10 ðŸ’—">
              <div class="pic"><img src="Foto%2010.jpeg" alt="Foto 10" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 10 ðŸ’—</div>
            </div>
            <div class="polaroid" style="--rot:1.4deg" data-src="Foto%2011.jpeg" data-title="Foto 11 âœ¨">
              <div class="pic"><img src="Foto%2011.jpeg" alt="Foto 11" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 11 âœ¨</div>
            </div>
            <div class="polaroid" style="--rot:-1.9deg" data-src="Foto%2012.jpeg" data-title="Foto 12 ðŸ’˜">
              <div class="pic"><img src="Foto%2012.jpeg" alt="Foto 12" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 12 ðŸ’˜</div>
            </div>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 4 -->
        <section class="page" data-page="3" aria-label="La gran pregunta">
          <div class="topline">
            <span>EdiciÃ³n especial</span>
            <span>Me gustas mucho</span>
            <span>Juntos por siempre</span>
          </div>
          <div class="rule"></div>

          <div class="grand">La gran pregunta</div>

          <div class="paragraph">
DespuÃ©s de analizar los hechos, recopilar datos
y comprobar la quÃ­mica innegable entre nosotrosâ€¦

AsÃ­ que ahora sÃ­â€¦

con el corazÃ³n en la mano
y una sonrisa nerviosa:
          </div>

          <div class="bigAsk">
            <div class="top">Â¿Quieres ser mi</div>
            <div class="bottom">San ValentÃ­n?</div>
          </div>

          <div class="ask">Elige tu respuesta:</div>

          <div class="btnStage" id="btnStage">
            <button class="choice yes" id="yesBtn" type="button">SÃ ðŸ’–</button>
            <button class="choice no" id="noBtn" type="button" tabindex="-1" aria-label="No (imposible)">NO ðŸ™ˆ</button>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 5 -->
        <section class="page" data-page="4" aria-label="Confirmado" id="finalPage">
          <div class="final">
            <div class="finalCard" id="finalCard">
              <div class="finalGlow" aria-hidden="true"></div>
              <h2>Confirmado oficialmente:</h2>

              <div class="lace">
                <div class="txt" id="finalText">Eres mi San ValentÃ­n.</div>
              </div>

              <div class="initials">
                <div class="init" id="init1">A</div>
                <div class="init" id="init2">J</div>
              </div>

              <p id="finalMsg">
Gracias por decir que sÃ­.
PrepÃ¡rate para un dÃ­a bonito,
sonrisas inevitables
y recuerdos que se van a quedar.
              </p>

              <div class="couponBox">
                <div class="t">ðŸŽŸï¸ CupÃ³n descargable</div>
                <div class="couponRow">
                  <button class="chip" id="dlCoupon" type="button">Descargar cupÃ³n âœ¨</button>
                  <button class="chip" id="copyMsg" type="button">Copiar mensajito ðŸ’Œ</button>
                </div>
              </div>
            </div>

            <div class="miniFooter" style="margin-top:16px;">Valentine Edition</div>
          </div>
        </section>

      </div>

      <!-- NAV -->
      <div class="nav" aria-label="NavegaciÃ³n">
        <div class="navMain">
          <button id="prev" type="button">PAG. ANTERIOR</button>
          <button id="next" type="button">PAG. SIGUIENTE</button>

          <div class="navChips">
            <button class="chip" id="toggleNight" type="button" aria-label="Cambiar modo">ðŸŒ™ Modo</button>
            <button class="chip" id="shareBtn" type="button" aria-label="Compartir">ðŸ“¤ Compartir</button>
          </div>
        </div>

        <div class="progressWrap" aria-label="Progreso">
          <div class="pageLabel" id="pageLabel">PÃG 1/5</div>
          <div class="bar" aria-hidden="true"><span></span></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ========= UTIL ========= */
    const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    function rand(min, max){ return Math.random() * (max - min) + min; }
    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }
    function vibrate(ms=18){ try{ if(navigator.vibrate) navigator.vibrate(ms); }catch{} }

    function toast(msg="Listo âœ¨"){
      const t = document.getElementById("toast");
      if(!t) return;
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=> t.classList.remove("show"), 1400);
    }

    /* âœ… Pausar animaciones al ir a segundo plano */
    document.addEventListener("visibilitychange", ()=>{
      const paused = document.hidden;
      document.documentElement.style.setProperty("--animPlay", paused ? "paused" : "running");
    });

    /* ========= CONFIG PERSONALIZACIÃ“N ========= */
    const NOMBRE = "Tu Amor";
    const INI_1 = "A";
    const INI_2 = "J";

    /* ========= AUDIO ========= */
    const bgMusic = document.getElementById("bgMusic");
    const sfxPage = document.getElementById("sfxPage");
    const sfxPop  = document.getElementById("sfxPop");

    const introHint = document.getElementById("introHint");
    let musicOn = false;

    if(localStorage.getItem("musicOn")==="1" && bgMusic){
      bgMusic.volume = 0.65;
      bgMusic.play().then(()=>{ musicOn = true; }).catch(()=>{});
    }

    function playSfx(el, vol=0.25){
      if(!el) return;
      try{
        el.currentTime = 0;
        el.volume = vol;
        el.play().catch(()=>{});
      }catch{}
    }

    async function tryPlayMusic(){
      if(!bgMusic || musicOn) return;
      try{
        bgMusic.volume = 0.65;
        await bgMusic.play();
        musicOn = true;
        localStorage.setItem("musicOn","1");
        if(introHint) introHint.textContent = "ðŸŽµ MÃºsica activada";
      }catch{
        if(introHint) introHint.textContent = "ðŸ’—";
      }
    }

    /* ========= TYPEWRITER ========= */
    function typewriter(el, text, speed=20){
      if(!el) return;
      el.textContent = "";
      let i = 0;
      const tick = () => {
        el.textContent += text[i] ?? "";
        i++;
        if(i < text.length) setTimeout(tick, speed);
      };
      tick();
    }
    typewriter(document.getElementById("letterText"), "Esto es solo el comienzoâ€¦\n(toca el corazÃ³n para abrir)", 20);

    /* ========= MINI PERSONALIZACIÃ“N UI ========= */
    const subRow = document.querySelector(".subhead-row span:nth-child(2)");
    if(subRow) subRow.textContent = `Para ${NOMBRE} ðŸ’—`;

    const topMonth = document.querySelector('.topline span:nth-child(3)');
    if(topMonth){
      const month = new Date().toLocaleDateString("es-CL",{month:"long"});
      topMonth.textContent = month.charAt(0).toUpperCase() + month.slice(1);
    }

    const init1 = document.getElementById("init1");
    const init2 = document.getElementById("init2");
    if(init1) init1.textContent = INI_1;
    if(init2) init2.textContent = INI_2;

    /* âœ… Mensaje final con â€œsaludoâ€ segÃºn hora */
    const finalMsg = document.getElementById("finalMsg");
    (function(){
      const h = new Date().getHours();
      let saludo = "Gracias por decir que sÃ­.";
      if(h < 12) saludo = "Buenos dÃ­asâ€¦ y gracias por decir que sÃ­.";
      else if(h < 19) saludo = "QuÃ© lindoâ€¦ gracias por decir que sÃ­.";
      else saludo = "Buenas nochesâ€¦ gracias por decir que sÃ­.";
      if(finalMsg){
        finalMsg.textContent =
`${saludo}
PrepÃ¡rate para un dÃ­a bonito,
sonrisas inevitables
y recuerdos que se van a quedar.`;
      }
    })();

    /* ========= FOTO PRINCIPAL ========= */
    const mainPhoto = document.getElementById("mainPhoto");
    const mainFrame = document.getElementById("mainFrame");
    if(mainPhoto && mainFrame){
      const done = () => {
        mainFrame.classList.remove("loading");
        mainFrame.classList.add("loaded");
      };
      if(mainPhoto.complete) done();
      else mainPhoto.addEventListener("load", done, { once:true });
      mainPhoto.addEventListener("error", ()=>{
        mainFrame.classList.remove("loading");
        toast("No se encontrÃ³ la foto ðŸ˜…");
      }, { once:true });
    }

    /* ========= PÃ‰TALOS ========= */
    const petals = document.getElementById("petals");
    const COUNT = window.innerWidth < 420 ? 40 : 70;
    if(petals){
      for(let i=0; i<COUNT; i++){
        const p = document.createElement("div");
        p.className = "petal";
        const r = Math.random();
        if(r < 0.22) p.classList.add("white");
        else if(r < 0.52) p.classList.add("soft");

        const size = rand(10, 22);
        p.style.width = size + "px";
        p.style.height = size + "px";
        p.style.left = rand(0, 100) + "vw";
        p.style.top  = rand(-30, 110) + "vh";
        p.style.setProperty("--x", rand(-40, 40) + "px");
        p.style.setProperty("--drift", rand(-220, 220) + "px");
        p.style.setProperty("--op", rand(.35, .95));
        p.style.animationDuration = rand(6.5, 13.5) + "s";
        p.style.animationDelay = rand(-13.5, 0) + "s";
        petals.appendChild(p);
      }
    }

    /* ========= INTRO: ABRIR CARTA ========= */
    const intro = document.getElementById("intro");
    const introCard = document.getElementById("introCard");
    const heartBtn = document.getElementById("heartBtn");
    let opened = false;

    if(heartBtn) heartBtn.addEventListener("pointerup", tryPlayMusic, { once:true });

    heartBtn.addEventListener("click", async () => {
      if(opened) return;
      opened = true;

      await tryPlayMusic();
      vibrate(20);

      introCard.classList.add("opened");
      confettiHeartsFromElement(heartBtn, 26);
      playSfx(sfxPop, 0.20);

      setTimeout(() => intro.classList.add("hide"), 850);
      setTimeout(() => {
        pages.forEach((p, idx) => p.classList.toggle("active", idx === current));
        updateNav();
        pages[current].scrollTop = 0;
      }, 900);
    });

    /* ========= SECRETO: sello ========= */
    const seal = document.getElementById("seal");
    let sealTaps = 0;
    let sealTimer = null;
    if(seal){
      seal.addEventListener("click", ()=>{
        sealTaps++;
        vibrate(12);
        if(sealTimer) clearTimeout(sealTimer);
        sealTimer = setTimeout(()=> sealTaps = 0, 900);

        if(sealTaps >= 5){
          sealTaps = 0;
          toast("Easter egg: Te elijo ðŸ’—");
          confettiHeartsFromElement(seal, 40);
          playSfx(sfxPop, 0.22);
        }
      });
    }

    /* ========= PÃGINAS + NAV + PROGRESO ========= */
    const pages = [...document.querySelectorAll(".page")];
    const prev = document.getElementById("prev");
    const next = document.getElementById("next");
    const pageLabel = document.getElementById("pageLabel");

    const TOTAL = pages.length;
    const ASK_INDEX = 3;
    const FINAL_INDEX = TOTAL - 1;

    let current = 0;
    localStorage.removeItem("page");

    function clearAnim(p){
      p.classList.remove("flip-in-right","flip-out-left","flip-in-left","flip-out-right");
    }

    function updateProgress(){
      const pct = ((current + 1) / TOTAL) * 100;
      document.documentElement.style.setProperty("--prog", pct.toFixed(2) + "%");
      if(pageLabel) pageLabel.textContent = `PÃG ${current+1}/${TOTAL}`;
    }

    function updateNav(){
      prev.disabled = current === 0;

      if(current === ASK_INDEX){
        next.classList.add("hidden");
        next.disabled = true;
      }else{
        next.classList.remove("hidden");
        next.disabled = current === FINAL_INDEX;
      }

      updateProgress();
    }

    function show(i, dir="right", sfx=true){
      const target = clamp(i, 0, FINAL_INDEX);
      if(target === current) return;

      const out = pages[current];
      const inc = pages[target];
      pages.forEach(clearAnim);

      out.classList.add("active");
      inc.classList.add("active");

      if(dir === "right"){
        out.classList.add("flip-out-left");
        inc.classList.add("flip-in-right");
      }else{
        out.classList.add("flip-out-right");
        inc.classList.add("flip-in-left");
      }

      if(sfx) playSfx(sfxPage, 0.18);
      vibrate(10);

      setTimeout(() => {
        pages.forEach((p, idx) => p.classList.toggle("active", idx === target));
        clearAnim(out); clearAnim(inc);
        current = target;
        pages[current].scrollTop = 0;

        updateNav();
        if(current === FINAL_INDEX) romanticFinal();
      }, 520);
    }

    prev.addEventListener("click", () => show(current - 1, "left"));
    next.addEventListener("click", () => show(current + 1, "right"));

    pages.forEach((p, idx)=> p.classList.toggle("active", idx === current));
    updateNav();

    window.addEventListener("keydown", (e)=>{
      if(intro && !intro.classList.contains("hide")) return;
      if(e.key === "ArrowLeft") show(current - 1, "left");
      if(e.key === "ArrowRight") show(current + 1, "right");
      if(e.key === "Escape") closeModal();
    });

    /* swipe */
    const magEl = document.querySelector(".mag");
    let sx=0, sy=0;
    if(magEl){
      magEl.addEventListener("touchstart", (e)=>{
        const t=e.touches[0]; sx=t.clientX; sy=t.clientY;
      }, {passive:true});

      magEl.addEventListener("touchend", (e)=>{
        if(intro && !intro.classList.contains("hide")) return;

        const t=e.changedTouches[0];
        const dx=t.clientX - sx;
        const dy=t.clientY - sy;

        if (Math.abs(dx) > 70 && Math.abs(dy) < 55){
          dx < 0 ? show(current + 1, "right") : show(current - 1, "left");
        }
      }, {passive:true});

      magEl.addEventListener("pointermove",(e)=>{
        const r = magEl.getBoundingClientRect();
        const x = ((e.clientX - r.left) / r.width) * 100;
        const y = ((e.clientY - r.top) / r.height) * 100;
        magEl.style.setProperty("--mx", x + "%");
        magEl.style.setProperty("--my", y + "%");
      });
    }

    /* ========= MODO NOCHE ========= */
    const toggleNight = document.getElementById("toggleNight");
    const savedNight = localStorage.getItem("night") === "1";
    if(savedNight) document.body.classList.add("night");

    if(toggleNight){
      toggleNight.addEventListener("click", ()=>{
        document.body.classList.toggle("night");
        localStorage.setItem("night", document.body.classList.contains("night") ? "1" : "0");
        vibrate(10);
        toast(document.body.classList.contains("night") ? "Modo noche ðŸŒ™" : "Modo dÃ­a â˜€ï¸");
      });
    }

    /* ========= SHARE ========= */
    const shareBtn = document.getElementById("shareBtn");
    if(shareBtn){
      shareBtn.addEventListener("click", async ()=>{
        vibrate(10);
        const text = `Valentine Edition ðŸ’˜ (para ${NOMBRE})`;
        try{
          if(navigator.share){
            await navigator.share({ title: "Valentine Edition ðŸ’˜", text });
            toast("Compartido âœ¨");
          }else{
            await navigator.clipboard.writeText(text);
            toast("Copiado al portapapeles âœ¨");
          }
        }catch{
          toast("No se pudo compartir ðŸ˜…");
        }
      });
    }

    /* ========= GALERÃA (modal) ========= */
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const modalTitle = document.getElementById("modalTitle");
    const closeModalBtn = document.getElementById("closeModal");
    const polaroids = document.getElementById("polaroids");

    function openModal(src, title){
      if(!modal || !modalImg) return;
      modalImg.src = src;
      if(modalTitle) modalTitle.textContent = title || "ðŸ’—";
      modal.classList.add("show");
      modal.setAttribute("aria-hidden","false");
      playSfx(sfxPop, 0.18);
      vibrate(12);
    }
    function closeModal(){
      if(!modal) return;
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden","true");
      if(modalImg) modalImg.src = "";
    }

    if(polaroids){
      polaroids.addEventListener("click", (e)=>{
        const card = e.target.closest(".polaroid");
        if(!card) return;
        openModal(card.dataset.src, card.dataset.title);
      });
    }
    if(closeModalBtn) closeModalBtn.addEventListener("click", closeModal);
    if(modal) modal.addEventListener("click", (e)=>{
      if(e.target === modal) closeModal();
    });

    /* ========= NO ULTRA (huye) ========= */
    const btnStage = document.getElementById("btnStage");
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");

    let animatingNo = false;
    let noX = 0, noY = 0;

    function stageLimits(){
      const s = btnStage.getBoundingClientRect();
      const b = noBtn.getBoundingClientRect();
      const pad = 12;
      const minX = s.width * 0.56;
      const maxX = s.width - b.width - pad;
      const minY = pad;
      const maxY = s.height - b.height - pad;
      return { s, b, minX, maxX, minY, maxY };
    }

    function setNoPos(x, y){
      noX = x; noY = y;
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
    }

    function placeNoInitial(){
      if(!btnStage || !noBtn) return;
      const { s, minX, maxX, minY, maxY } = stageLimits();
      setNoPos(clamp(s.width * 0.66, minX, maxX), clamp(s.height * 0.50, minY, maxY));
    }

    function springTo(targetX, targetY){
      if(prefersReduced){ setNoPos(targetX, targetY); return; }
      if(animatingNo) return;
      animatingNo = true;

      let vx = 0, vy = 0;
      const stiffness = 0.20;
      const damping = 0.72;
      const snap = 0.7;

      function step(){
        const dx = targetX - noX;
        const dy = targetY - noY;

        vx = (vx + dx * stiffness) * damping;
        vy = (vy + dy * stiffness) * damping;

        noX += vx; noY += vy;

        const rot = clamp(vx * 0.35, -14, 14);
        noBtn.style.transform = `translate(0,0) rotate(${rot}deg)`;
        noBtn.style.left = noX + "px";
        noBtn.style.top  = noY + "px";

        if(Math.abs(dx) < snap && Math.abs(dy) < snap && Math.abs(vx) < 0.55 && Math.abs(vy) < 0.55){
          noBtn.style.transform = `translate(0,0) rotate(0deg)`;
          animatingNo = false;
          return;
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function dodgeNo(ev){
      const { s, b, minX, maxX, minY, maxY } = stageLimits();

      const px = ev ? (ev.clientX - s.left) : (s.width * 0.70);
      const py = ev ? (ev.clientY - s.top)  : (s.height * 0.50);

      const cx = noX + b.width/2;
      const cy = noY + b.height/2;

      let dx = cx - px;
      let dy = cy - py;
      const len = Math.hypot(dx, dy) || 1;
      dx /= len; dy /= len;

      const flee = 240 + Math.random() * 260;
      let tx = (noX + dx * flee) + (Math.random()*2 - 1) * 80;
      let ty = (noY + dy * flee) + (Math.random()*2 - 1) * 55;

      tx = clamp(tx, minX, maxX);
      ty = clamp(ty, minY, maxY);

      springTo(tx, ty);
      vibrate(8);
    }

    if(noBtn){
      noBtn.addEventListener("pointermove", dodgeNo);
      noBtn.addEventListener("pointerdown", (e)=>{ e.preventDefault(); e.stopPropagation(); dodgeNo(e); });
      noBtn.addEventListener("mouseenter", dodgeNo);
      noBtn.addEventListener("touchstart", (e)=>{
        e.preventDefault(); e.stopPropagation();
        const t = e.touches[0];
        dodgeNo({ clientX: t.clientX, clientY: t.clientY });
      }, {passive:false});
    }

    window.addEventListener("resize", placeNoInitial);
    placeNoInitial();

    /* ========= CORAZONES PRO ========= */
    function confettiHeartsFromElement(el, count = 42){
      if(prefersReduced) return;
      const r = el.getBoundingClientRect();

      for(let i=0; i<count; i++){
        const fx = document.createElement("div");
        fx.className = "heartFXPro";
        fx.textContent = Math.random() < .72 ? "ðŸ’–" : (Math.random() < .55 ? "ðŸ’˜" : "âœ¨");

        const x = r.left + rand(0.15, 0.85) * r.width;
        const y = r.top  + rand(0.10, 0.90) * r.height;

        fx.style.left = x + "px";
        fx.style.top  = y + "px";
        fx.style.fontSize = rand(16, 30) + "px";

        const dx = rand(-260, 260);
        const dy = rand(-260, -520);
        const rot = rand(-520, 520) + "deg";
        const dur = rand(1400, 2400) + "ms";

        fx.style.setProperty("--dx", dx + "px");
        fx.style.setProperty("--dy", dy + "px");
        fx.style.setProperty("--rot", rot);
        fx.style.setProperty("--dur", dur);

        document.body.appendChild(fx);
        setTimeout(()=> fx.remove(), parseFloat(dur) + 120);
      }
    }

    /* ========= SÃ -> FINAL ========= */
    function goFinal(){
      confettiHeartsFromElement(yesBtn, 60);
      playSfx(sfxPop, 0.22);
      vibrate(24);
      show(FINAL_INDEX, "right");
    }
    if(yesBtn){
      yesBtn.addEventListener("click", (e)=>{ e.preventDefault(); e.stopPropagation(); goFinal(); });
      yesBtn.addEventListener("pointerup", (e)=>{ e.preventDefault(); e.stopPropagation(); goFinal(); });
    }

    /* ========= FINAL ========= */
    function romanticFinal(){
      const finalCard = document.getElementById("finalCard");
      if(!finalCard) return;
      finalCard.classList.add("finalOn");
      confettiHeartsFromElement(finalCard, 52);
      playSfx(sfxPop, 0.18);

      const lace = finalCard.querySelector(".lace");
      if(!prefersReduced && lace){
        lace.animate(
          [{transform:"scale(1)"},{transform:"scale(1.03)"},{transform:"scale(1)"}],
          {duration: 1200, easing:"cubic-bezier(.2,.7,.2,1)"}
        );
      }
    }

    /* ========= CUPÃ“N: Descargar ========= */
    const dlCoupon = document.getElementById("dlCoupon");
    const copyMsg = document.getElementById("copyMsg");

    function makeCouponPng(){
      const w = 1080, h = 720;
      const c = document.createElement("canvas");
      c.width = w; c.height = h;
      const ctx = c.getContext("2d");

      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "#ffd1df");
      g.addColorStop(1, "#ff8fb0");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      ctx.globalAlpha = 0.18;
      ctx.fillStyle = "#ffffff";
      ctx.beginPath();
      ctx.ellipse(w*0.25, h*0.22, 280, 200, 0, 0, Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;

      ctx.fillStyle = "rgba(255,255,255,.90)";
      roundRect(ctx, 80, 90, w-160, h-180, 36, true, false);

      ctx.strokeStyle = "rgba(225,23,79,.35)";
      ctx.lineWidth = 6;
      ctx.setLineDash([14, 12]);
      roundRect(ctx, 120, 130, w-240, h-260, 30, false, true);
      ctx.setLineDash([]);

      ctx.fillStyle = "rgba(225,23,79,.95)";
      ctx.font = "900 64px Times New Roman, ui-serif, serif";
      ctx.textAlign = "center";
      ctx.fillText("CUPÃ“N OFICIAL", w/2, 230);

      ctx.font = "900 48px Times New Roman, ui-serif, serif";
      ctx.fillText("Vale por una cita sorpresa âœ¨", w/2, 315);

      ctx.fillStyle = "rgba(42,31,36,.78)";
      ctx.font = "700 34px Times New Roman, ui-serif, serif";
      ctx.fillText(`Para: ${NOMBRE}`, w/2, 395);

      ctx.font = "700 30px Times New Roman, ui-serif, serif";
      ctx.fillText("Canjeable por: abrazos, risas y un dÃ­a bonito ðŸ’—", w/2, 455);

      ctx.fillStyle = "rgba(225,23,79,.95)";
      ctx.font = "900 56px Times New Roman, ui-serif, serif";
      ctx.fillText(`${INI_1} + ${INI_2}`, w/2, 545);

      ctx.fillStyle = "rgba(42,31,36,.55)";
      ctx.font = "900 22px Arial, ui-sans-serif, system-ui";
      ctx.fillText("VALENTINE EDITION", w/2, 610);

      return c.toDataURL("image/png");
    }

    function roundRect(ctx, x, y, w, h, r, fill, stroke){
      if (typeof r === "number") r = {tl:r,tr:r,br:r,bl:r};
      ctx.beginPath();
      ctx.moveTo(x + r.tl, y);
      ctx.lineTo(x + w - r.tr, y);
      ctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);
      ctx.lineTo(x + w, y + h - r.br);
      ctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);
      ctx.lineTo(x + r.bl, y + h);
      ctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);
      ctx.lineTo(x, y + r.tl);
      ctx.quadraticCurveTo(x, y, x + r.tl, y);
      ctx.closePath();
      if(fill) ctx.fill();
      if(stroke) ctx.stroke();
    }

    if(dlCoupon){
      dlCoupon.addEventListener("click", ()=>{
        try{
          const url = makeCouponPng();
          const a = document.createElement("a");
          a.href = url;
          a.download = "cupon-valentine.png";
          document.body.appendChild(a);
          a.click();
          a.remove();
          playSfx(sfxPop, 0.18);
          vibrate(14);
          toast("CupÃ³n descargado âœ¨");
        }catch{
          toast("No se pudo crear el cupÃ³n ðŸ˜…");
        }
      });
    }

    if(copyMsg){
      copyMsg.addEventListener("click", async ()=>{
        try{
          const txt = `Eres mi San ValentÃ­n ðŸ’—\n(Valentine Edition para ${NOMBRE})`;
          await navigator.clipboard.writeText(txt);
          playSfx(sfxPop, 0.14);
          vibrate(10);
          toast("Copiado ðŸ’Œ");
        }catch{
          toast("No se pudo copiar ðŸ˜…");
        }
      });
    }
  </script>
</body>
</html>
