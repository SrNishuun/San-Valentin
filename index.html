<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffd1df" />
  <title>Valentine Edition ğŸ’˜</title>

  <style>
    :root{
      --pink0:#fff2f7;
      --pink1:#ffd1df;
      --rose:#e1174f;
      --rose2:#ff2d6b;
      --ink:#2a1f24;

      --shadow: 0 26px 70px rgba(0,0,0,.18);
      --shadow2: 0 16px 40px rgba(0,0,0,.12);

      --r: 22px;
      --ease: cubic-bezier(.2,.8,.2,1);
      --ease2: cubic-bezier(.2,.7,.2,1);

      --serif: ui-serif, "Times New Roman", Times, Georgia, serif;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      --script: "Brush Script MT","Segoe Script","Lucida Handwriting","Apple Chancery","Snell Roundhand",cursive;

      --line: rgba(225,23,79,.65);
      --line2: rgba(225,23,79,.28);
      --animPlay: running;

      --prog: 0%;
    }

    body.night{
      background: radial-gradient(900px 700px at 20% 10%, rgba(255,45,107,.18), transparent 55%),
                  linear-gradient(135deg, #120a10, #2a0f1b);
      color: rgba(255,255,255,.88);
      color-scheme: dark;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color: var(--ink);
      font-family: var(--sans);
      overflow:hidden;
      background: linear-gradient(135deg, var(--pink0), var(--pink1));
    }

    button:focus-visible{
      outline: 3px solid rgba(225,23,79,.55);
      outline-offset: 4px;
    }

    .bg-aurora{
      position: fixed; inset:-22%;
      z-index:-5;
      background:
        radial-gradient(900px 560px at 18% 20%, rgba(225,23,79,.28), transparent 60%),
        radial-gradient(900px 560px at 85% 30%, rgba(255,255,255,.70), transparent 60%),
        radial-gradient(900px 560px at 55% 90%, rgba(255,45,107,.20), transparent 60%),
        linear-gradient(135deg, var(--pink0), var(--pink1));
      filter: saturate(1.10);
      animation: auroraDrift 9s var(--ease2) infinite alternate;
      animation-play-state: var(--animPlay);
    }
    body.night .bg-aurora{
      opacity:.55;
      filter: saturate(1.2) contrast(1.05);
      background:
        radial-gradient(900px 560px at 18% 20%, rgba(255,45,107,.20), transparent 60%),
        radial-gradient(900px 560px at 85% 30%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(900px 560px at 55% 90%, rgba(225,23,79,.20), transparent 60%),
        linear-gradient(135deg, #120a10, #2a0f1b);
    }
    @keyframes auroraDrift{
      from{ transform: translate3d(-1.7%, -1.1%, 0) scale(1.03); }
      to  { transform: translate3d( 1.7%,  1.2%, 0) scale(1.10); }
    }

    .bg-grain{
      position: fixed; inset:-30%;
      z-index:-4;
      opacity:.16;
      background-image:
        repeating-linear-gradient(0deg, rgba(0,0,0,.05) 0px, rgba(0,0,0,.05) 1px, transparent 2px, transparent 6px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.04) 0px, rgba(0,0,0,.04) 1px, transparent 2px, transparent 7px);
      mix-blend-mode: multiply;
      animation: grainMove 7s linear infinite;
      animation-play-state: var(--animPlay);
    }
    body.night .bg-grain{ opacity:.12; mix-blend-mode: screen; }
    @keyframes grainMove{
      0%   { transform: translate3d(-2%, -2%, 0) rotate(0deg); }
      100% { transform: translate3d( 2%,  2%, 0) rotate(1deg); }
    }

    .petals{
      position: fixed; inset:-10%;
      z-index:-3;
      pointer-events:none;
    }
    .petal{
      position:absolute;
      width: 14px; height: 14px;
      border-radius: 6px 14px 6px 14px;
      background: rgba(225,23,79,.30);
      box-shadow: 0 10px 22px rgba(225,23,79,.10);
      animation: fall linear infinite;
      animation-play-state: var(--animPlay);
      transform: rotate(15deg);
      opacity: 0;
    }
    .petal.white{ background: rgba(255,255,255,.72); }
    .petal.soft { background: rgba(255,45,107,.18); }
    body.night .petal.white{ background: rgba(255,255,255,.38); }
    @keyframes fall{
      0%   { transform: translate3d(var(--x), -140px, 0) rotate(0deg); opacity:0; }
      10%  { opacity:var(--op); }
      100% { transform: translate3d(calc(var(--x) + var(--drift)), 120vh, 0) rotate(340deg); opacity:0; }
    }

    @media (prefers-reduced-motion: reduce){
      .bg-aurora, .bg-grain, .petal{ animation:none !important; }
    }

    /* Intro */
    .intro{
      position: fixed; inset:0;
      z-index: 50;
      display:grid;
      place-items:center;
      padding: 18px;
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      transition: opacity .55s var(--ease), transform .55s var(--ease);
    }
    .intro.hide{
      opacity:0;
      transform: translateY(-10px);
      pointer-events:none;
    }
    .introCard{
      width: min(520px, 92vw);
      border-radius: var(--r);
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(255,255,255,.85);
      box-shadow: var(--shadow);
      padding: 20px 18px 22px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    body.night .introCard{
      background: rgba(20,12,18,.55);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.88);
    }
    .introTitle{
      font-family: var(--serif);
      color: rgba(225,23,79,.92);
      font-weight: 900;
      font-size: 18px;
      margin: 2px 0 8px;
    }
    body.night .introTitle{ color: rgba(255,122,152,.95); }
    .introSub{
      color: rgba(91,73,82,.80);
      font-size: 13.5px;
      margin: 0 0 14px;
    }
    body.night .introSub{ color: rgba(255,255,255,.70); }

    .envWrap{
      position:relative;
      margin: 8px auto 0;
      width: min(360px, 86vw);
      height: 310px;
    }
    .softShadow{
      position:absolute;
      left:50%; bottom: 12px;
      transform: translateX(-50%);
      width: 78%;
      height: 26px;
      background: radial-gradient(closest-side, rgba(0,0,0,.18), transparent 70%);
      filter: blur(2px);
      opacity:.55;
    }
    .letter{
      position:absolute;
      left:50%;
      top: 22px;
      transform: translateX(-50%);
      width: 86%;
      height: 205px;
      background: linear-gradient(180deg, #fffafc, #fff0f6);
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow2);
      padding: 18px 16px 16px;
      z-index: 2;
      transition: transform .75s var(--ease), top .75s var(--ease);
    }
    body.night .letter{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.12);
    }
    .letter::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: 12px;
      border: 1px dashed rgba(0,0,0,.10);
      pointer-events:none;
    }
    body.night .letter::before{ border: 1px dashed rgba(255,255,255,.20); }
    .letter h2{
      margin: 8px 0 10px;
      font-family: var(--serif);
      font-size: 18px;
      letter-spacing: -0.02em;
      color: rgba(42,31,36,.88);
    }
    body.night .letter h2{ color: rgba(255,255,255,.90); }
    .letter p{
      margin: 0;
      color: rgba(91,73,82,.88);
      font-size: 13.5px;
      line-height: 1.45;
      white-space: pre-line;
      min-height: 3.5em;
    }
    body.night .letter p{ color: rgba(255,255,255,.78); }

    .heartBtn{
      position:absolute;
      left:50%;
      bottom: 52px;
      transform: translateX(-50%);
      width: 68px;
      height: 60px;
      border: 0;
      cursor: pointer;
      background: transparent;
      z-index: 6;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.18));
      -webkit-tap-highlight-color: transparent;
    }
    .heart{
      width: 100%;
      height: 100%;
      position: relative;
      transform: rotate(-45deg);
      background: var(--rose2);
      border-radius: 10px;
      animation: heartPulse 1.1s var(--ease) infinite;
      animation-play-state: var(--animPlay);
    }
    .heart::before,
    .heart::after{
      content:"";
      position:absolute;
      width: 100%;
      height: 100%;
      background: var(--rose2);
      border-radius: 50%;
    }
    .heart::before{ top: -50%; left: 0; }
    .heart::after { left: 50%; top: 0; }
    @keyframes heartPulse{
      0%,100%{ transform: rotate(-45deg) scale(1); }
      50%    { transform: rotate(-45deg) scale(1.08); }
    }

    .envelope{
      position:absolute;
      left:50%;
      bottom: 0;
      transform: translateX(-50%);
      width: 92%;
      height: 190px;
      border-radius: 18px;
      background: linear-gradient(180deg, #f7a5bc, #f38aaa);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow2);
      z-index: 3;
      overflow:hidden;
    }
    body.night .envelope{
      background: linear-gradient(180deg, rgba(255,122,152,.45), rgba(225,23,79,.35));
      border: 1px solid rgba(255,255,255,.12);
    }
    .flapTop{
      position:absolute;
      left:0; right:0;
      top: 0;
      height: 0;
      border-left: 166px solid transparent;
      border-right: 166px solid transparent;
      border-top: 110px solid #fbd0dc;
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform .75s var(--ease);
      z-index: 5;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.10));
    }
    body.night .flapTop{ border-top-color: rgba(255,255,255,.18); }
    .flapLeft{
      position:absolute;
      left:0; bottom:0;
      width:0; height:0;
      border-right: 166px solid transparent;
      border-top: 95px solid rgba(255,255,255,.12);
      border-bottom: 95px solid rgba(0,0,0,.03);
      opacity:.45;
      z-index:4;
    }
    .flapRight{
      position:absolute;
      right:0; bottom:0;
      width:0; height:0;
      border-left: 166px solid transparent;
      border-top: 95px solid rgba(255,255,255,.10);
      border-bottom: 95px solid rgba(0,0,0,.02);
      opacity:.40;
      z-index:4;
    }
    .flapBottom{
      position:absolute;
      left:0; right:0;
      bottom:0;
      height:0;
      border-left: 166px solid transparent;
      border-right: 166px solid transparent;
      border-bottom: 110px solid rgba(255,255,255,.18);
      opacity:.55;
      z-index:4;
    }
    .seal{
      position:absolute;
      left: 22px;
      bottom: 16px;
      width: 64px;
      height: 64px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff2d55, #ff7a98);
      box-shadow: 0 14px 30px rgba(255,45,85,.25);
      display:grid;
      place-items:center;
      z-index: 6;
      transform: rotate(-6deg);
      opacity:.92;
      cursor: pointer;
      user-select:none;
    }
    .seal span{
      color:white;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .03em;
      user-select:none;
    }

    .introCard.opened .flapTop{ transform: rotateX(160deg); }
    .introCard.opened .letter{
      top: 6px;
      transform: translateX(-50%) translateY(-18px);
    }

    .introHint{
      margin-top: 14px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.85);
      color: rgba(42,31,36,.70);
      font-weight: 800;
      font-size: 13px;
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      user-select:none;
    }
    body.night .introHint{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.75);
    }

    /* App */
    .app{
      height:100%;
      display:grid;
      place-items:center;
      padding: 18px;
    }

    .mag{
      width: min(560px, 94vw);
      height: min(980px, 92vh);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.52));
      border: 1px solid rgba(255,255,255,.85);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
      --mx: 50%;
      --my: 30%;
      perspective: 1200px;
      transform-style: preserve-3d;
      touch-action: pan-y;
    }
    body.night .mag{
      background: linear-gradient(180deg, rgba(20,12,18,.62), rgba(20,12,18,.45));
      border: 1px solid rgba(255,255,255,.12);
    }

    .mag::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 700px at 30% 10%, rgba(225,23,79,.08), transparent 65%),
        radial-gradient(1200px 700px at 80% 30%, rgba(255,255,255,.55), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.20), rgba(0,0,0,.02));
      opacity:.95;
      pointer-events:none;
    }
    body.night .mag::before{
      opacity:.55;
      background:
        radial-gradient(1200px 700px at 30% 10%, rgba(255,45,107,.12), transparent 65%),
        radial-gradient(1200px 700px at 80% 30%, rgba(255,255,255,.08), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.04));
    }

    .mag::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(400px 260px at var(--mx) var(--my),
        rgba(255,255,255,.35), transparent 60%);
      pointer-events:none;
      mix-blend-mode: screen;
      opacity:.55;
    }
    body.night .mag::after{ opacity:.38; }

    .pages{ position:absolute; inset:0; }

    .page{
      position:absolute; inset:0;
      padding: 18px 18px 92px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      opacity:0;
      pointer-events:none;
      transform-origin: 50% 50%;
      backface-visibility: hidden;
      will-change: transform, opacity;
    }
    .page.active{ opacity:1; pointer-events:auto; }

    .page.cover{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .page.flip-in-right{ animation: flipInRight .55s var(--ease) both; }
    .page.flip-out-left{ animation: flipOutLeft .45s var(--ease) both; }
    .page.flip-in-left{ animation: flipInLeft .55s var(--ease) both; }
    .page.flip-out-right{ animation: flipOutRight .45s var(--ease) both; }

    @keyframes flipInRight{
      from{ opacity:0; transform: translate3d(20px,0,0) rotateY(-26deg) scale(.99); }
      to  { opacity:1; transform: translate3d(0,0,0) rotateY(0deg) scale(1); }
    }
    @keyframes flipOutLeft{
      from{ opacity:1; transform: translate3d(0,0,0) rotateY(0deg); }
      to  { opacity:0; transform: translate3d(-16px,0,0) rotateY(22deg); }
    }
    @keyframes flipInLeft{
      from{ opacity:0; transform: translate3d(-20px,0,0) rotateY(26deg) scale(.99); }
      to  { opacity:1; transform: translate3d(0,0,0) rotateY(0deg) scale(1); }
    }
    @keyframes flipOutRight{
      from{ opacity:1; transform: translate3d(0,0,0) rotateY(0deg); }
      to  { opacity:0; transform: translate3d(16px,0,0) rotateY(-22deg); }
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size: 12px;
      color: rgba(42,31,36,.62);
      letter-spacing: .08em;
      text-transform: uppercase;
      gap: 10px;
    }
    body.night .topline{ color: rgba(255,255,255,.60); }

    .rule{
      height:2px;
      background: var(--line);
      margin: 10px 0 10px;
      opacity:.65;
    }
    .rule.thin{
      height:1px;
      opacity:.45;
      background: var(--line2);
    }

    .masthead{
      text-align:center;
      font-family: var(--serif);
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--rose);
      font-size: clamp(34px, 7vw, 46px);
      line-height: 1;
      margin: 6px 0 6px;
    }
    body.night .masthead{ color: rgba(255,122,152,.95); }

    .subhead-row{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      font-size: 12.5px;
      color: rgba(42,31,36,.70);
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 0 4px;
      flex-wrap: wrap;
    }
    body.night .subhead-row{ color: rgba(255,255,255,.68); }

    .bigQuestion{
      text-align:center;
      margin: 14px 0 8px;
      font-family: var(--serif);
      color: rgba(225,23,79,.92);
    }
    body.night .bigQuestion{ color: rgba(255,122,152,.95); }
    .bigQuestion .small{
      font-size: 22px;
      letter-spacing: .06em;
      text-transform: uppercase;
    }
    .bigQuestion .script{
      font-size: clamp(42px, 7.2vw, 52px);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1;
    }

    .centerNote{
      text-align:center;
      margin: 10px 0 12px;
      color: rgba(42,31,36,.70);
      font-family: var(--serif);
      letter-spacing: .02em;
    }
    body.night .centerNote{ color: rgba(255,255,255,.70); }

    .columns{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:stretch;
    }
    @media (max-width: 520px){ .columns{ grid-template-columns: 1fr; } }

    .article, .photo{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(225,23,79,.18);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      height: 100%;
    }
    body.night .article, body.night .photo{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }

    .article .kicker{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      font-family: var(--serif);
      font-style: italic;
      color: rgba(42,31,36,.72);
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(225,23,79,.18);
      padding-bottom: 8px;
      flex-wrap: wrap;
    }
    body.night .article .kicker{
      color: rgba(255,255,255,.70);
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .article p{
      margin:0;
      font-family: var(--serif);
      color: rgba(42,31,36,.78);
      line-height: 1.55;
      font-size: 15.5px;
      white-space: pre-line;
    }
    body.night .article p{ color: rgba(255,255,255,.76); }

    .photo{ display:flex; flex-direction:column; }

    .frame{
      width:100%;
      aspect-ratio: 4 / 5;
      border-radius: 12px;
      background:
        radial-gradient(240px 180px at 30% 25%, rgba(225,23,79,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,.35));
      border: 1px solid rgba(225,23,79,.20);
      display:grid;
      place-items:center;
      overflow:hidden;
      position:relative;
      flex: 1 1 auto;
    }
    .frame.loading::after{
      content:"";
      position:absolute; inset:-40%;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.45) 20%, transparent 40%);
      opacity:.55;
      transform: translateX(-40%);
      animation: shimmer 1.2s linear infinite;
      animation-play-state: var(--animPlay);
      pointer-events:none;
    }
    @keyframes shimmer{ to{ transform: translateX(60%); } }
    body.night .frame.loading::after{ opacity:.22; }

    .frame img{
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(1.02);
      filter: saturate(1.05) contrast(1.03);
      opacity: 0;
      transition: opacity .35s var(--ease), transform .55s var(--ease);
    }
    .frame.loaded img{ opacity:1; }
    .frame:hover img{ transform: scale(1.06); }
    @media (hover: none){ .frame:hover img{ transform: scale(1.02); } }

    .overlayBtn{
      margin-top: 10px;
      display:block;
      width:100%;
      border-radius: 999px;
      border: 2px solid rgba(225,23,79,.55);
      background: rgba(255,255,255,.45);
      color: rgba(225,23,79,.92);
      font-weight: 900;
      padding: 10px 12px;
      text-align:center;
      letter-spacing: .02em;
      user-select:none;
    }
    body.night .overlayBtn{
      background: rgba(255,255,255,.08);
      border: 2px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.90);
    }

    /* CupÃ³n horizontal */
    .tickets{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      align-items:stretch;
    }
    .ticket{
      border-radius: 18px;
      border: 1px solid rgba(225,23,79,.25);
      background: rgba(255,255,255,.60);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      overflow:hidden;
      display:flex;
      min-height: 86px;
      flex-direction: column;
    }
    body.night .ticket{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .ticket .stub{
      padding: 10px 12px;
      font-weight: 900;
      letter-spacing: .08em;
      text-transform: uppercase;
      text-align:center;
      background: linear-gradient(180deg, rgba(225,23,79,.95), rgba(255,45,107,.85));
      color: rgba(255,255,255,.95);
      border-bottom: 1px dashed rgba(255,255,255,.35);
    }
    body.night .ticket .stub{
      background: linear-gradient(180deg, rgba(255,45,107,.78), rgba(225,23,79,.62));
      border-bottom: 1px dashed rgba(255,255,255,.22);
    }
    .ticket .body{
      flex:1;
      padding: 12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 6px;
      text-align:left;
    }
    .ticket .body .label{
      color: rgba(42,31,36,.62);
      font-weight: 800;
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 11px;
    }
    body.night .ticket .body .label{ color: rgba(255,255,255,.62); }
    .ticket .body .value{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      font-size: 18px;
      letter-spacing: -0.01em;
    }
    body.night .ticket .body .value{ color: rgba(255,122,152,.95); }

    /* Page 2 */
    .p2Header{
      text-align:center;
      margin: 8px 0 10px;
      padding: 0 6px;
    }
    .p2Header .t1{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.95);
      font-size: 52px;
      line-height: 1;
      letter-spacing: -0.02em;
    }
    body.night .p2Header .t1{ color: rgba(255,122,152,.95); }
    .p2Header .t2{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.95);
      font-size: 34px;
      line-height: 1.05;
      letter-spacing: -0.02em;
      margin-top: 2px;
    }
    body.night .p2Header .t2{ color: rgba(255,122,152,.92); }
    .p2Header .t3{
      font-family: var(--script);
      font-weight: 900;
      color: rgba(225,23,79,.78);
      font-size: 46px;
      line-height: 1.05;
      margin-top: -2px;
      letter-spacing: -0.01em;
    }
    body.night .p2Header .t3{ color: rgba(255,255,255,.70); }

    .matrixWrap{
      margin-top: 6px;
      border-radius: 18px;
      background:
        radial-gradient(900px 420px at 50% 25%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border: 1px solid rgba(225,23,79,.18);
      padding: 8px 8px 10px;
      box-shadow: 0 12px 28px rgba(0,0,0,.06);
      position:relative;
      overflow:hidden;
    }
    body.night .matrixWrap{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
    }
    .matrix{
      position:relative;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      border-radius: 14px;
      overflow:hidden;
      min-height: 380px;
    }
    @media (max-width:520px){ .matrix{ min-height: 430px; } }

    .cell{
      position:relative;
      display:grid;
      place-items:center;
      padding: 10px 8px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(225,23,79,.55);
    }
    body.night .cell{
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.18);
    }
    .cell.r1{ border-top: 0; }
    .cell.r3{ border-bottom: 0; }
    .cell.c1{ border-left: 0; }
    .cell.c3{ border-right: 0; }

    .reasonBlock{
      width: 100%;
      max-width: 210px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(225,23,79,.92);
      line-height: 1.28;
      font-size: 14px;
      white-space: pre-line;
      position:relative;
      z-index:2;
    }
    body.night .reasonBlock{ color: rgba(255,122,152,.92); }

    .reasonBlock .n{
      position:absolute;
      top: -8px;
      left: -4px;
      font-size: 28px;
      font-weight: 900;
      color: rgba(225,23,79,.95);
      transform: rotate(-2deg);
      text-shadow: 0 10px 18px rgba(0,0,0,.08);
    }
    body.night .reasonBlock .n{ color: rgba(255,122,152,.95); }
    .reasonBlock .txt{ display:block; padding-top: 16px; }

    .bigHeart{
      font-size: 44px;
      line-height: 1;
      filter: drop-shadow(0 16px 20px rgba(225,23,79,.18));
      animation: heartFloat 2.3s var(--ease2) infinite alternate;
      animation-play-state: var(--animPlay);
      user-select:none;
      z-index:2;
    }
    @keyframes heartFloat{
      from{ transform: translateY(3px) scale(1); }
      to  { transform: translateY(-3px) scale(1.03); }
    }

    /* Page 3 gallery */
    .galleryTitle{
      text-align:center;
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.95);
      margin: 10px 0 4px;
      font-size: 34px;
      letter-spacing: -0.02em;
    }
    body.night .galleryTitle{ color: rgba(255,122,152,.95); }
    .gallerySub{
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.70);
      margin: 0 0 14px;
      font-size: 15px;
    }
    body.night .gallerySub{ color: rgba(255,255,255,.70); }

    .polaroids{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-top: 10px;
    }
    @media (max-width:520px){ .polaroids{ grid-template-columns: 1fr; } }

    .polaroid{
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(225,23,79,.18);
      border-radius: 18px;
      box-shadow: 0 16px 34px rgba(0,0,0,.08);
      padding: 12px;
      position:relative;
      transform: rotate(var(--rot));
      transition: transform .25s var(--ease), box-shadow .25s var(--ease);
      cursor: pointer;
      overflow:hidden;
      user-select:none;
    }
    body.night .polaroid{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 34px rgba(0,0,0,.22);
    }
    .polaroid:hover{
      transform: rotate(var(--rot)) translateY(-2px);
      box-shadow: 0 20px 42px rgba(0,0,0,.10);
    }

    .polaroid .pic{
      width:100%;
      aspect-ratio: 4 / 3;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(225,23,79,.20);
      background:
        radial-gradient(240px 180px at 30% 25%, rgba(225,23,79,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,.35));
      position:relative;
    }
    body.night .polaroid .pic{ border: 1px solid rgba(255,255,255,.12); }

    .polaroid img{
      width:100%; height:100%;
      object-fit: cover;
      transform: scale(1.02);
      filter: saturate(1.06) contrast(1.02);
      transition: transform .55s var(--ease);
    }
    .polaroid:hover img{ transform: scale(1.06); }

    .polaroid .cap{
      margin-top: 10px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.78);
      font-size: 14px;
      letter-spacing: .01em;
    }
    body.night .polaroid .cap{ color: rgba(255,255,255,.78); }

    /* Modal */
    .modal{
      position: fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      place-items:center;
      z-index: 120;
      padding: 16px;
    }
    .modal.show{ display:grid; }
    .modalCard{
      width: min(920px, 95vw);
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.50);
      box-shadow: 0 26px 80px rgba(0,0,0,.28);
      overflow:hidden;
      transform: scale(.98);
      animation: modalIn .18s var(--ease) both;
    }
    body.night .modalCard{
      background: rgba(18,10,16,.92);
      border: 1px solid rgba(255,255,255,.12);
    }
    @keyframes modalIn{ to{ transform: scale(1); } }

    .modalTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(225,23,79,.14);
      background: rgba(255,255,255,.65);
    }
    body.night .modalTop{
      background: rgba(255,255,255,.06);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalTop .t{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
    }
    body.night .modalTop .t{ color: rgba(255,122,152,.95); }
    .modalTop button{
      border: 0;
      background: rgba(20,20,25,.12);
      color: rgba(20,20,25,.82);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
    }
    body.night .modalTop button{
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.90);
    }
    .modalImg{
      width:100%;
      height: min(72vh, 680px);
      object-fit: contain;
      display:block;
      background: rgba(0,0,0,.08);
    }
    .modalDesc{
      padding: 12px 14px 14px;
      background: rgba(255,255,255,.75);
      border-top: 1px solid rgba(225,23,79,.14);
      font-family: var(--serif);
      color: rgba(42,31,36,.78);
      line-height: 1.45;
      font-size: 15px;
      white-space: pre-line;
    }
    body.night .modalDesc{
      background: rgba(255,255,255,.06);
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.78);
    }

    /* Page 4 ask */
    .grand{
      text-align:center;
      font-family: var(--serif);
      color: rgba(225,23,79,.95);
      margin: 14px 0 10px;
      font-weight: 900;
      font-size: 34px;
      letter-spacing: -0.02em;
    }
    body.night .grand{ color: rgba(255,122,152,.95); }

    .paragraph{
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.72);
      line-height: 1.6;
      margin: 0 10px;
      font-size: 16px;
      white-space: pre-line;
    }
    body.night .paragraph{ color: rgba(255,255,255,.70); }

    .bigAsk{
      margin: 12px 0 8px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(225,23,79,.95);
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: 1.05;
    }
    body.night .bigAsk{ color: rgba(255,122,152,.95); }
    .bigAsk .top{ font-size: 34px; }
    .bigAsk .bottom{ font-size: 40px; font-style: italic; }

    .ask{
      margin-top: 10px;
      text-align:center;
      font-family: var(--serif);
      color: rgba(42,31,36,.70);
      font-size: 16px;
      letter-spacing: .02em;
    }
    body.night .ask{ color: rgba(255,255,255,.68); }

    .btnStage{
      margin: 16px auto 0;
      width: min(480px, 94%);
      height: 110px;
      border-radius: 18px;
      background: rgba(255,255,255,.38);
      border: 1px solid rgba(225,23,79,.18);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.40);
      position:relative;
      overflow:hidden;
      display:grid;
      place-items:center;
      touch-action: manipulation;
    }
    body.night .btnStage{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .choice{
      position:absolute;
      min-width: 170px;
      padding: 14px 16px;
      border-radius: 999px;
      border: 2px solid rgba(225,23,79,.58);
      background: rgba(255,255,255,.58);
      color: rgba(225,23,79,.95);
      font-weight: 900;
      letter-spacing: .02em;
      box-shadow: 0 14px 28px rgba(0,0,0,.08);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    body.night .choice{
      background: rgba(255,255,255,.08);
      border: 2px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.90);
      box-shadow: 0 14px 28px rgba(0,0,0,.22);
    }

    .choice.yes{
      z-index: 6;
      left: 50%;
      top: 50%;
      transform: translate(-112%, -50%);
    }

    .choice.no{
      z-index: 5;
      border: 0;
      background: rgba(20,20,25,.78);
      color: rgba(255,255,255,.94);
      box-shadow: 0 14px 28px rgba(0,0,0,.12);
      min-width: 120px;

      left: 50%;
      top: 50%;
      transform: translate(12%, -50%);

      will-change: left, top, transform;
      transition:
        left .20s var(--ease),
        top .20s var(--ease),
        transform .20s var(--ease),
        filter .20s var(--ease);
    }
    .choice.no:hover{ filter: brightness(1.06); }
    body.night .choice.no{ background: rgba(0,0,0,.55); }

    /* Final */
    .final{
      height: calc(100% - 0px);
      display:grid;
      place-items:center;
      padding-top: 18px;
    }
    .finalCard{
      width: min(460px, 92%);
      border-radius: 24px;
      background: rgba(225,23,79,.88);
      color: rgba(255,255,255,.95);
      box-shadow: 0 22px 60px rgba(225,23,79,.22);
      border: 1px solid rgba(255,255,255,.18);
      padding: 20px 16px 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    body.night .finalCard{
      background: rgba(255,45,107,.55);
      box-shadow: 0 22px 60px rgba(0,0,0,.32);
      border: 1px solid rgba(255,255,255,.12);
    }
    .finalCard::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(520px 360px at 20% 20%, rgba(255,255,255,.18), transparent 60%);
      pointer-events:none;
    }
    .finalCard h2{
      margin: 6px 0 14px;
      font-family: var(--serif);
      font-size: 36px;
      font-weight: 900;
      letter-spacing: -0.02em;
      position:relative;
    }
    .lace{
      width: 220px;
      height: 160px;
      margin: 0 auto 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:relative;
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
      overflow:hidden;
    }
    body.night .lace{
      background: rgba(255,255,255,.10);
      box-shadow: 0 18px 40px rgba(0,0,0,.28);
    }
    .lace::before{
      content:"";
      position:absolute; inset:10px;
      border-radius: 999px;
      border: 2px dashed rgba(225,23,79,.35);
    }
    body.night .lace::before{ border: 2px dashed rgba(255,255,255,.18); }
    .lace .txt{
      position:absolute; inset:0;
      display:grid; place-items:center;
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      font-size: 26px;
      letter-spacing: -0.02em;
      padding: 0 12px;
      text-align:center;
    }
    body.night .lace .txt{ color: rgba(255,255,255,.92); }

    .initials{
      display:flex; justify-content:center; gap:10px;
      margin-top: -12px; position:relative;
    }
    .init{
      width: 58px; height: 44px;
      border-radius: 14px;
      background: rgba(255,255,255,.92);
      color: rgba(225,23,79,.92);
      font-weight: 1000;
      display:grid; place-items:center;
      box-shadow: 0 14px 30px rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.55);
      font-family: var(--serif);
      font-size: 22px;
    }
    body.night .init{
      background: rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 30px rgba(0,0,0,.28);
    }
    .finalCard p{
      margin: 14px 0 0;
      position:relative;
      font-family: var(--serif);
      font-size: 16px;
      line-height: 1.55;
      opacity:.95;
      white-space: pre-line;
    }

    .couponBox{
      margin: 16px auto 0;
      width: min(520px, 95%);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(225,23,79,.18);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      padding: 12px;
      text-align:center;
    }
    body.night .couponBox{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .couponBox .t{
      font-family: var(--serif);
      font-weight: 900;
      color: rgba(225,23,79,.92);
      font-size: 18px;
      margin: 4px 0 10px;
    }
    body.night .couponBox .t{ color: rgba(255,122,152,.95); }

    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(225,23,79,.22);
      background: rgba(255,255,255,.55);
      font-weight: 900;
      letter-spacing: .02em;
      font-size: 12px;
      color: rgba(42,31,36,.72);
      box-shadow: 0 12px 24px rgba(0,0,0,.06);
      cursor:pointer;
    }
    body.night .chip{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.85);
      box-shadow: 0 12px 24px rgba(0,0,0,.22);
    }

    /* Footer + Nav */
    .miniFooter{
      text-align:center;
      margin-top: 14px;
      font-size: 11px;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: rgba(42,31,36,.45);
      opacity:.8;
    }
    body.night .miniFooter{ color: rgba(255,255,255,.40); }

    .nav{
      position:absolute;
      left:0; right:0; bottom:0;
      padding: 10px 12px 12px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(to top, rgba(255,255,255,.80), rgba(255,255,255,0));
      backdrop-filter: blur(6px);
      border-top: 1px solid rgba(225,23,79,.10);
      z-index: 10;
      flex-wrap: wrap;
      align-items:center;
    }
    body.night .nav{
      background: linear-gradient(to top, rgba(10,8,10,.72), rgba(10,8,10,0));
      border-top: 1px solid rgba(255,255,255,.10);
    }

    .navMain{
      display:flex;
      gap: 10px;
      flex: 1 1 320px;
      align-items:center;
    }

    .nav button{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(225,23,79,.35);
      background: rgba(255,255,255,.60);
      color: rgba(225,23,79,.92);
      font-weight: 900;
      letter-spacing: .03em;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.06);
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s var(--ease), opacity .2s var(--ease), filter .2s var(--ease);
      user-select:none;
    }
    .nav button:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .nav button:active{ transform: scale(.985); }
    .nav button[disabled]{ opacity:.40; cursor:not-allowed; }

    body.night .nav button{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
      box-shadow: 0 12px 24px rgba(0,0,0,.22);
    }

    #prev, #next{ flex: 1 1 150px; max-width: 220px; }

    .navChips{
      display:flex;
      gap: 8px;
      flex: 0 0 auto;
      align-items:center;
      justify-content:flex-end;
    }

    .progressWrap{
      width: 100%;
      margin-top: 8px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pageLabel{
      font-family: var(--serif);
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(42,31,36,.62);
      min-width: 74px;
      text-align:center;
    }
    body.night .pageLabel{ color: rgba(255,255,255,.62); }
    .bar{
      flex:1;
      height: 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.06);
      overflow:hidden;
      border: 1px solid rgba(225,23,79,.18);
    }
    body.night .bar{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .bar > span{
      display:block;
      height: 100%;
      width: var(--prog);
      background: linear-gradient(90deg, rgba(225,23,79,.85), rgba(255,45,107,.70));
      border-radius: 999px;
      transition: width .35s var(--ease);
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(10px);
      background: rgba(20,20,25,.88);
      color: rgba(255,255,255,.96);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      letter-spacing: .02em;
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      z-index: 140;
      transition: opacity .18s var(--ease), transform .18s var(--ease);
      box-shadow: 0 16px 34px rgba(0,0,0,.22);
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0px);
    }

    /* Confetti hearts */
    .heartFX{
      position: fixed;
      z-index: 80;
      pointer-events:none;
      will-change: transform, opacity;
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.25));
      animation: fly var(--dur) var(--ease) forwards;
      animation-play-state: var(--animPlay);
      opacity: 0;
    }
    @keyframes fly{
      0%{ opacity:0; transform: translate3d(0,0,0) rotate(0deg) scale(.85); }
      12%{ opacity:1; transform: translate3d(0,-10px,0) rotate(0deg) scale(1); }
      100%{ opacity:0; transform: translate3d(var(--dx), var(--dy), 0) rotate(var(--rot)) scale(.95); }
    }
  </style>
</head>

<body>
  <audio id="bgMusic" preload="auto" loop>
    <source src="Stuck%20with%20you.mp3" type="audio/mpeg">
  </audio>
  <audio id="sfxPage" preload="auto"><source src="page.mp3" type="audio/mpeg"></audio>
  <audio id="sfxPop"  preload="auto"><source src="pop.mp3" type="audio/mpeg"></audio>

  <div class="bg-aurora"></div>
  <div class="bg-grain"></div>
  <div class="petals" id="petals" aria-hidden="true"></div>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-label="Vista de foto">
      <div class="modalTop">
        <div class="t" id="modalTitle">ğŸ’—</div>
        <button id="closeModal" type="button" aria-label="Cerrar">Cerrar âœ•</button>
      </div>
      <img class="modalImg" id="modalImg" alt="Foto ampliada">
      <div class="modalDesc" id="modalDesc"></div>
    </div>
  </div>

  <div class="toast" id="toast">Listo âœ¨</div>

  <!-- INTRO -->
  <section class="intro" id="intro" aria-label="Inicio con carta">
    <div class="introCard" id="introCard">
      <div class="introTitle">Te tengo una sorpresaâ€¦ ğŸ’Œ</div>
      <div class="introSub">Para descubrirla, toca el corazÃ³n</div>

      <div class="envWrap">
        <div class="letter" id="letter">
          <h2>Para ti ğŸ’—</h2>
          <p id="letterText" aria-live="polite"></p>
        </div>

        <button class="heartBtn" id="heartBtn" aria-label="Abrir sobre">
          <div class="heart"></div>
        </button>

        <div class="envelope" aria-hidden="true">
          <div class="flapTop" id="flap"></div>
          <div class="flapLeft"></div>
          <div class="flapRight"></div>
          <div class="flapBottom"></div>
          <div class="seal" id="seal"><span>LOVE</span></div>
        </div>

        <div class="softShadow"></div>
      </div>

      <div class="introHint" id="introHint">âœ¨ Se abre con amor</div>
    </div>
  </section>

  <!-- REVISTA -->
  <div class="app">
    <div class="mag" id="mag" role="application" aria-label="Valentine Edition">
      <div class="pages" id="pages">

        <!-- PAGE 1 -->
        <section class="page active cover" data-page="0" aria-label="Portada">
          <div class="topline">
            <span>EdiciÃ³n especial</span>
            <span>Valentine</span>
            <span id="monthTag">Febrero</span>
          </div>

          <div class="masthead">Valentine Edition</div>
          <div class="rule"></div>

          <div class="subhead-row">
            <span>14 de febrero</span>
            <span id="forTag">Para ti ğŸ’—</span>
            <span>Para toda la vida</span>
          </div>

          <div class="rule thin"></div>

          <div class="bigQuestion">
            <div class="small">Will you be my</div>
            <div class="script">Valentine?</div>
          </div>

          <div class="centerNote">
            DistribuciÃ³n: <b>exclusiva</b> para la persona mÃ¡s especial ğŸ’—
          </div>

          <div class="columns">
            <div class="article">
              <div class="kicker">
                <span>14 de Febrero</span>
                <span>San ValentÃ­n</span>
              </div>
              <p>
Mediante este regalito quiero que sepas lo importante que eres en mi vida. Eres mi mejor amiga, mi compaÃ±era de aventuras, mi lugar seguro y mi persona favorita. Gracias por quedarte, por apoyarme y por hacer que lo simple se sienta especial. Te elijo hoy, maÃ±ana y siempre ğŸ¤
              </p>
            </div>

            <div class="photo">
              <div class="frame loading" id="mainFrame" aria-label="Foto de nosotros">
                <img id="mainPhoto" src="foto.jpg.jpeg" alt="Nuestra foto" loading="eager" decoding="async">
              </div>
              <div class="overlayBtn">Â¿Aceptas la misiÃ³n de ser mi San ValentÃ­n?</div>
            </div>
          </div>

          <!-- CupÃ³n (sin cine) -->
          <div class="tickets">
            <div class="ticket">
              <div class="stub">San ValentÃ­n</div>
              <div class="body">
                <div class="label">CupÃ³n para:</div>
                <div class="value">Una cita sorpresa âœ¨</div>
              </div>
            </div>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 2 -->
        <section class="page" data-page="1" aria-label="Razones">
          <div class="topline">
            <span>Te Amo Mucho</span><span>ğŸ’—</span><span>Siempre</span>
          </div>
          <div class="rule"></div>

          <div class="p2Header">
            <div class="t1">5 Razones</div>
            <div class="t2">por las que eres</div>
            <div class="t3">Mi elecciÃ³n perfecta</div>
          </div>

          <div class="matrixWrap">
            <div class="matrix" aria-label="Matriz de 5 razones">
              <div class="cell r1 c1">
                <div class="reasonBlock">
                  <div class="n">1</div>
                  <span class="txt">Porque contigo quiero construir todo lo que viene, paso a paso. ğŸ’</span>
                </div>
              </div>
              <div class="cell r1 c2"><div class="bigHeart">â¤ï¸</div></div>
              <div class="cell r1 c3">
                <div class="reasonBlock">
                  <div class="n">3</div>
                  <span class="txt">Porque me inspiras a ser mejor cada dÃ­a. ğŸŒ¿</span>
                </div>
              </div>

              <div class="cell r2 c1"><div class="bigHeart">â¤ï¸</div></div>
              <div class="cell r2 c2">
                <div class="reasonBlock">
                  <div class="n">2</div>
                  <span class="txt">Porque contigo no solo sueÃ±o, tambiÃ©n construyo. ğŸ¡</span>
                </div>
              </div>
              <div class="cell r2 c3"><div class="bigHeart">â¤ï¸</div></div>

              <div class="cell r3 c1">
                <div class="reasonBlock">
                  <div class="n">4</div>
                  <span class="txt">Porque somos el mejor equipo que pueda existir. ğŸ¤</span>
                </div>
              </div>
              <div class="cell r3 c2"><div class="bigHeart">â¤ï¸</div></div>
              <div class="cell r3 c3">
                <div class="reasonBlock">
                  <div class="n">5</div>
                  <span class="txt">Porque contigo aprendÃ­ lo que realmente significa amar. â¤ï¸</span>
                </div>
              </div>
            </div>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 3 -->
        <section class="page" data-page="2" aria-label="GalerÃ­a">
          <div class="topline">
            <span>EdiciÃ³n especial</span><span>Recuerdos</span><span>ğŸ’</span>
          </div>
          <div class="rule"></div>

          <div class="galleryTitle">Mini galerÃ­a</div>
          <div class="gallerySub">Toca una polaroid para verla en grande âœ¨</div>

          <div class="polaroids" id="polaroids">
            <div class="polaroid" style="--rot:-2.4deg" data-src="Foto%201.jpeg" data-title="ğŸ’—" data-desc="CÃ³mo olvidar cuando me fuiste a buscar al terminal. ğŸšŒğŸ’">
              <div class="pic"><img src="Foto%201.jpeg" alt="Foto 1" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸ’—</div>
            </div>

            <div class="polaroid" style="--rot:1.7deg" data-src="Foto%202.jpeg" data-title="ğŸŒ¸" data-desc="Este fue el dÃ­a en que conocÃ­ a tu mamitaâ€¦ Me trae nostalgia el dpto. ğŸŒ·ğŸ¤">
              <div class="pic"><img src="Foto%202.jpeg" alt="Foto 2" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸŒ¸</div>
            </div>

            <div class="polaroid" style="--rot:2.2deg" data-src="Foto%203.jpeg" data-title="ğŸ¡" data-desc="Cuando fuimos al October y me dieron el doble de fichas jejeâ€¦ contigo la suerte y la risa siempre se multiplican. ğŸ»âœ¨">
              <div class="pic"><img src="Foto%203.jpeg" alt="Foto 3" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸ¡</div>
            </div>

            <div class="polaroid" style="--rot:-1.3deg" data-src="Foto%204.jpeg" data-title="ğŸ„" data-desc="Nuestra primera Navidad en familiaâ€¦ un pedacito de hogar que quiero repetir toda la vida. ğŸâ¤ï¸">
              <div class="pic"><img src="Foto%204.jpeg" alt="Foto 4" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸ„</div>
            </div>

            <div class="polaroid" style="--rot:1.2deg" data-src="Foto%205.jpeg" data-title="âœ¨" data-desc="QuÃ© elegancia y belleza juntas en una misma fotoâ€¦ ğŸ˜ğŸ‘‘">
              <div class="pic"><img src="Foto%205.jpeg" alt="Foto 5" loading="lazy" decoding="async"></div>
              <div class="cap">âœ¨</div>
            </div>

            <div class="polaroid" style="--rot:-2.0deg" data-src="Foto%206.jpeg" data-title="ğŸ¬" data-desc="Nuestra primera vez (de muchas) en el cineâ€¦ una de nuestras primeras citas, te amo demasiado ğŸ¿ğŸ’—">
              <div class="pic"><img src="Foto%206.jpeg" alt="Foto 6" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸ¬</div>
            </div>

            <div class="polaroid" style="--rot:2.6deg" data-src="Foto%207.jpeg" data-title="ğŸŒŠ" data-desc="QuÃ© dÃ­a mÃ¡s lindoâ€¦ el agua estaba helada y a mÃ­ me dieron muchas ganas de ir al baÃ±o jajaja ğŸ˜‚ğŸ«¶">
              <div class="pic"><img src="Foto%207.jpeg" alt="Foto 7" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸŒŠ</div>
            </div>

            <div class="polaroid" style="--rot:-1.6deg" data-src="Foto%208.jpeg" data-title="ğŸš—" data-desc="Cuando quedamos en pana y tenÃ­amos que ir a CaÃ±ete jajaâ€¦ y aun asÃ­, lo pasÃ© increÃ­ble porque estabas tÃº. ğŸ¤­â¤ï¸">
              <div class="pic"><img src="Foto%208.jpeg" alt="Foto 8" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸš—</div>
            </div>

            <div class="polaroid" style="--rot:1.9deg" data-src="Foto%209.jpeg" data-title="ğŸ«§" data-desc="Foto de nuestro primer aniversario en el jacuzzi afuera del domoâ€¦ burbujas, frÃ­o afuera y amor calentito adentro. ğŸ¥°â™¨ï¸">
              <div class="pic"><img src="Foto%209.jpeg" alt="Foto 9" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸ¥‚</div>
            </div>

            <div class="polaroid" style="--rot:-2.2deg" data-src="Foto%2010.jpeg" data-title="ğŸï¸" data-desc="Cuando nos lloviÃ³ en el valle y andÃ¡bamos en motoâ€¦ Contigo cualquier aventura vale la pena. ğŸŒ§ï¸ğŸ’˜">
              <div class="pic"><img src="Foto%2010.jpeg" alt="Foto 10" loading="lazy" decoding="async"></div>
              <div class="cap">Foto 10 ğŸï¸</div>
            </div>

            <div class="polaroid" style="--rot:1.4deg" data-src="Foto%2011.jpeg" data-title="â›°ï¸" data-desc="El Diego nos tomÃ³ esta linda foto en el PichachÃ©nâ€¦ QuÃ© suerte la mÃ­a de tenerte. ğŸ“¸ğŸ¤">
              <div class="pic"><img src="Foto%2011.jpeg" alt="Foto 11" loading="lazy" decoding="async"></div>
              <div class="cap">â›°ï¸</div>
            </div>

            <div class="polaroid" style="--rot:-1.9deg" data-src="Foto%2012.jpeg" data-title="ğŸ–ï¸" data-desc="Cuando fuimos a la playa con los chiquillosâ€¦ sol, risas y nosotros, como siempre, guardando recuerdos para el corazÃ³n. ğŸŒğŸ’">
              <div class="pic"><img src="Foto%2012.jpeg" alt="Foto 12" loading="lazy" decoding="async"></div>
              <div class="cap">ğŸ–ï¸</div>
            </div>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 4 -->
        <section class="page" data-page="3" aria-label="La gran pregunta">
          <div class="topline">
            <span>14 de Febrero</span><span>Te Amo Mucho</span><span>Para toda la vida</span>
          </div>
          <div class="rule"></div>

          <div class="grand">La gran pregunta</div>

          <div class="paragraph">
DespuÃ©s de analizar los hechos, recopilar datos
y comprobar la quÃ­mica innegable entre nosotrosâ€¦

AsÃ­ que ahora sÃ­â€¦
          </div>

          <div class="bigAsk">
            <div class="top">Â¿Quieres ser mi</div>
            <div class="bottom">San ValentÃ­n?</div>
          </div>

          <div class="ask">Elige tu respuesta:</div>

          <div class="btnStage" id="btnStage">
            <button class="choice yes" id="yesBtn" type="button">SÃ ğŸ’–</button>
            <button class="choice no" id="noBtn" type="button" tabindex="-1" aria-label="No (imposible)">NO ğŸ™ˆ</button>
          </div>

          <div class="miniFooter">Valentine Edition</div>
        </section>

        <!-- PAGE 5 -->
        <section class="page" data-page="4" aria-label="Confirmado" id="finalPage">
          <div class="final">
            <div class="finalCard" id="finalCard">
              <h2>Confirmado oficialmente:</h2>

              <div class="lace">
                <div class="txt" id="finalText">Eres mi San ValentÃ­n.</div>
              </div>

              <div class="initials">
                <div class="init" id="init1">N</div>
                <div class="init" id="init2">C</div>
              </div>

              <p id="finalMsg">
PrepÃ¡rate para un dÃ­a bonito,
sonrisas inevitables
y recuerdos para toda la vida.
              </p>

              <div class="couponBox">
                <div class="t">ğŸŸï¸ CupÃ³n descargable</div>
                <button class="chip" id="dlCoupon" type="button">Descargar cupÃ³n âœ¨</button>
              </div>
            </div>

            <div class="miniFooter" style="margin-top:16px;">Valentine Edition</div>
          </div>
        </section>

      </div>

      <!-- NAV -->
      <div class="nav" aria-label="NavegaciÃ³n">
        <div class="navMain">
          <button id="prev" type="button">PAG. ANTERIOR</button>
          <button id="next" type="button">PAG. SIGUIENTE</button>

          <div class="navChips">
            <button class="chip" id="toggleNight" type="button" aria-label="Cambiar modo">ğŸŒ™ Modo</button>
          </div>
        </div>

        <div class="progressWrap" aria-label="Progreso">
          <div class="pageLabel" id="pageLabel">PÃG 1/5</div>
          <div class="bar" aria-hidden="true"><span id="progBar"></span></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* Helpers */
    const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    function rand(min, max){ return Math.random() * (max - min) + min; }
    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }
    function vibrate(ms=18){ try{ if(navigator.vibrate) navigator.vibrate(ms); }catch{} }

    function toast(msg="Listo âœ¨"){
      const t = document.getElementById("toast");
      if(!t) return;
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=> t.classList.remove("show"), 1400);
    }

    document.addEventListener("visibilitychange", ()=>{
      const paused = document.hidden;
      document.documentElement.style.setProperty("--animPlay", paused ? "paused" : "running");
    });

    /* Config */
    const NOMBRE = "Mi Amolchito";
    const INI_1 = "N";
    const INI_2 = "C";

    /* Audio */
    const bgMusic = document.getElementById("bgMusic");
    const sfxPage = document.getElementById("sfxPage");
    const sfxPop  = document.getElementById("sfxPop");
    const introHint = document.getElementById("introHint");
    let musicOn = false;

    function playSfx(el, vol=0.25){
      if(!el) return;
      try{
        el.currentTime = 0;
        el.volume = vol;
        el.play().catch(()=>{});
      }catch{}
    }

    async function tryPlayMusic(){
      if(!bgMusic || musicOn) return;
      try{
        bgMusic.volume = 0.65;
        await bgMusic.play();
        musicOn = true;
        localStorage.setItem("musicOn","1");
        if(introHint) introHint.textContent = "ğŸµ MÃºsica activada";
      }catch{
        if(introHint) introHint.textContent = "ğŸ’—";
      }
    }

    /* Typewriter */
    function typewriter(el, text, speed=18){
      if(!el) return;
      el.textContent = "";
      let i = 0;
      const tick = () => {
        el.textContent += text[i] ?? "";
        i++;
        if(i < text.length) setTimeout(tick, speed);
      };
      tick();
    }
    typewriter(document.getElementById("letterText"), "Esto es solo el comienzoâ€¦\n(toca el corazÃ³n para abrir)", 18);

    /* Month + For tags */
    const forTag = document.getElementById("forTag");
    if(forTag) forTag.textContent = `Para ${NOMBRE} ğŸ’—`;
    const monthTag = document.getElementById("monthTag");
    if(monthTag){
      const month = new Date().toLocaleDateString("es-CL",{month:"long"});
      monthTag.textContent = month.charAt(0).toUpperCase() + month.slice(1);
    }

    /* Initials */
    const init1 = document.getElementById("init1");
    const init2 = document.getElementById("init2");
    if(init1) init1.textContent = INI_1;
    if(init2) init2.textContent = INI_2;

    /* Main image loading */
    const mainPhoto = document.getElementById("mainPhoto");
    const mainFrame = document.getElementById("mainFrame");
    if(mainPhoto && mainFrame){
      const done = () => { mainFrame.classList.remove("loading"); mainFrame.classList.add("loaded"); };
      if(mainPhoto.complete) done();
      else mainPhoto.addEventListener("load", done, { once:true });
      mainPhoto.addEventListener("error", ()=>{ mainFrame.classList.remove("loading"); toast("No se encontrÃ³ la foto ğŸ˜…"); }, { once:true });
    }

    /* Petals */
    const petals = document.getElementById("petals");
    const COUNT = window.innerWidth < 420 ? 40 : 70;
    if(petals){
      for(let i=0; i<COUNT; i++){
        const p = document.createElement("div");
        p.className = "petal";
        const r = Math.random();
        if(r < 0.22) p.classList.add("white");
        else if(r < 0.52) p.classList.add("soft");

        const size = rand(10, 22);
        p.style.width = size + "px";
        p.style.height = size + "px";
        p.style.left = rand(0, 100) + "vw";
        p.style.top  = rand(-30, 110) + "vh";
        p.style.setProperty("--x", rand(-40, 40) + "px");
        p.style.setProperty("--drift", rand(-220, 220) + "px");
        p.style.setProperty("--op", rand(.35, .95));
        p.style.animationDuration = rand(6.5, 13.5) + "s";
        p.style.animationDelay = rand(-13.5, 0) + "s";
        petals.appendChild(p);
      }
    }

    /* Confetti hearts */
    function confettiHearts(x, y, count=20){
      if(prefersReduced) return;
      for(let i=0; i<count; i++){
        const el = document.createElement("div");
        el.className = "heartFX";
        el.textContent = (Math.random() < .5) ? "ğŸ’–" : "ğŸ’—";
        el.style.left = x + "px";
        el.style.top = y + "px";
        el.style.fontSize = rand(18, 34) + "px";
        el.style.setProperty("--dx", rand(-180, 180) + "px");
        el.style.setProperty("--dy", rand(-260, -520) + "px");
        el.style.setProperty("--rot", rand(-220, 220) + "deg");
        el.style.setProperty("--dur", rand(700, 1200) + "ms");
        document.body.appendChild(el);
        setTimeout(()=> el.remove(), 1400);
      }
    }
    function confettiHeartsFromElement(btn, count=22){
      const r = btn.getBoundingClientRect();
      confettiHearts(r.left + r.width/2, r.top + r.height/2, count);
    }

    /* Intro open */
    const intro = document.getElementById("intro");
    const introCard = document.getElementById("introCard");
    const heartBtn = document.getElementById("heartBtn");
    let opened = false;

    if(heartBtn) heartBtn.addEventListener("pointerup", tryPlayMusic, { once:true });

    if(heartBtn){
      heartBtn.addEventListener("click", async () => {
        if(opened) return;
        opened = true;
        await tryPlayMusic();
        vibrate(20);
        introCard.classList.add("opened");
        confettiHeartsFromElement(heartBtn, 26);
        playSfx(sfxPop, 0.20);
        setTimeout(() => intro.classList.add("hide"), 850);
      });
    }

    /* Pages nav */
    const pages = Array.from(document.querySelectorAll(".page"));
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const pageLabel = document.getElementById("pageLabel");
    const progBar = document.getElementById("progBar");
    let idx = 0;

    // âœ… BLOQUEO: solo se puede entrar a la pÃ¡gina final si apretaron "SÃ"
    let allowFinal = false; // cambia a true solo al presionar SÃ
    const FINAL_INDEX = 4;  // pÃ¡gina 5 (0-based)
    const ASK_INDEX   = 3;  // pÃ¡gina 4 (donde estÃ¡ el SÃ/NO)

    function updateProgress(){
      const total = pages.length;
      const p = ((idx+1)/total)*100;
      document.documentElement.style.setProperty("--prog", p.toFixed(2) + "%");
      if(pageLabel) pageLabel.textContent = `PÃG ${idx+1}/${total}`;

      if(prevBtn) prevBtn.disabled = (idx === 0);

      // âœ… si estÃ¡s en la pÃ¡g 4 y NO han apretado "SÃ", deshabilita "SIGUIENTE"
      const blockNext = (idx === ASK_INDEX && !allowFinal);
      if(nextBtn) nextBtn.disabled = (idx === total-1) || blockNext;

      if(progBar) progBar.style.width = p.toFixed(2) + "%";
    }

    function goTo(newIdx, dir=1){
      newIdx = clamp(newIdx, 0, pages.length-1);

      // âœ… no permitir entrar a la Ãºltima pÃ¡gina si no apretÃ³ "SÃ"
      if(newIdx === FINAL_INDEX && !allowFinal){
        toast("Solo puedes pasar si presionas SÃ ğŸ’–");
        vibrate(10);
        return;
      }

      if(newIdx === idx) return;

      const from = pages[idx];
      const to = pages[newIdx];

      to.scrollTop = 0;

      from.classList.remove("active");
      to.classList.add("active");

      pages.forEach(p=>{
        p.classList.remove("flip-in-right","flip-out-left","flip-in-left","flip-out-right");
      });

      if(dir > 0){
        from.classList.add("flip-out-left");
        to.classList.add("flip-in-right");
      }else{
        from.classList.add("flip-out-right");
        to.classList.add("flip-in-left");
      }

      idx = newIdx;
      updateProgress();
      playSfx(sfxPage, 0.18);
      vibrate(10);
    }

    if(prevBtn) prevBtn.addEventListener("click", ()=> goTo(idx-1, -1));
    if(nextBtn) nextBtn.addEventListener("click", ()=> goTo(idx+1,  1));

    document.addEventListener("keydown", (e)=>{
      if(e.key === "ArrowRight") goTo(idx+1, 1);
      if(e.key === "ArrowLeft")  goTo(idx-1,-1);
    });

    updateProgress();

    /* Tilt highlight in magazine */
    const mag = document.getElementById("mag");
    if(mag){
      mag.addEventListener("pointermove", (e)=>{
        const r = mag.getBoundingClientRect();
        const mx = ((e.clientX - r.left)/r.width)*100;
        const my = ((e.clientY - r.top)/r.height)*100;
        mag.style.setProperty("--mx", mx.toFixed(2) + "%");
        mag.style.setProperty("--my", my.toFixed(2) + "%");
      });
    }

    /* Night mode */
    const toggleNight = document.getElementById("toggleNight");
    const nightSaved = localStorage.getItem("night") === "1";
    if(nightSaved) document.body.classList.add("night");
    if(toggleNight){
      toggleNight.addEventListener("click", ()=>{
        document.body.classList.toggle("night");
        localStorage.setItem("night", document.body.classList.contains("night") ? "1" : "0");
        toast(document.body.classList.contains("night") ? "Modo noche ğŸŒ™" : "Modo dÃ­a â˜€ï¸");
      });
    }

    /* Modal Gallery */
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const modalTitle = document.getElementById("modalTitle");
    const modalDesc = document.getElementById("modalDesc");
    const closeModal = document.getElementById("closeModal");
    const polaroids = document.getElementById("polaroids");

    function openModal(src, title, desc){
      if(!modal) return;
      modal.classList.add("show");
      modal.setAttribute("aria-hidden","false");
      if(modalImg) modalImg.src = src;
      if(modalTitle) modalTitle.textContent = title || "ğŸ’—";
      if(modalDesc) modalDesc.textContent = desc || "";
      playSfx(sfxPop, 0.16);
      vibrate(12);
    }
    function closeModalFn(){
      if(!modal) return;
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden","true");
      if(modalImg) modalImg.src = "";
    }

    if(polaroids){
      polaroids.addEventListener("click", (e)=>{
        const card = e.target.closest(".polaroid");
        if(!card) return;
        openModal(card.dataset.src, card.dataset.title, card.dataset.desc);
      });
    }
    if(closeModal) closeModal.addEventListener("click", closeModalFn);
    if(modal) modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModalFn(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModalFn(); });

    /* NO button dodge PRO */
    const noBtn = document.getElementById("noBtn");
    const stage = document.getElementById("btnStage");

    const NO_POINTS = [
      [0.10,0.25],[0.22,0.25],[0.34,0.25],[0.46,0.25],[0.58,0.25],[0.70,0.25],[0.82,0.25],
      [0.10,0.55],[0.22,0.55],[0.34,0.55],[0.46,0.55],[0.58,0.55],[0.70,0.55],[0.82,0.55],
      [0.16,0.82],[0.30,0.82],[0.44,0.82],[0.58,0.82],[0.72,0.82]
    ];
    let lastNoIndex = -1;
    let dodgeLockUntil = 0;

    function setNoAt(px, py, rotateDeg=0){
      if(!noBtn) return;
      noBtn.style.left = px + "px";
      noBtn.style.top  = py + "px";
      noBtn.style.transform = `translate(0,0) rotate(${rotateDeg}deg)`;
    }

    function pickNextPoint(){
      let tries = 0;
      let i = Math.floor(Math.random() * NO_POINTS.length);
      while(i === lastNoIndex && tries < 6){
        i = Math.floor(Math.random() * NO_POINTS.length);
        tries++;
      }
      lastNoIndex = i;
      return NO_POINTS[i];
    }

    function moveNo(reason="hover"){
      if(!noBtn || !stage) return;

      const now = performance.now();
      if(now < dodgeLockUntil) return;
      dodgeLockUntil = now + 90;

      const r = stage.getBoundingClientRect();
      const pad = 10;

      const bw = noBtn.offsetWidth || 120;
      const bh = noBtn.offsetHeight || 48;

      const [px, py] = pickNextPoint();

      let x = (r.width  * px) - (bw / 2);
      let y = (r.height * py) - (bh / 2);

      x += rand(-8, 8);
      y += rand(-6, 6);

      x = clamp(x, pad, r.width  - bw - pad);
      y = clamp(y, pad, r.height - bh - pad);

      const rot = (reason === "near") ? rand(-4,4) : rand(-2.5,2.5);

      setNoAt(x, y, rot);
      playSfx(sfxPop, 0.10);
      vibrate(8);
    }

    if(noBtn){
      ["mouseenter","pointerenter","touchstart","pointerdown"].forEach(evt=>{
        noBtn.addEventListener(evt, (e)=>{ e.preventDefault(); moveNo("hover"); }, { passive:false });
      });
      noBtn.addEventListener("click", (e)=>{ e.preventDefault(); moveNo("click"); });
    }

    if(stage && noBtn){
      stage.addEventListener("pointermove", (e)=>{
        const br = noBtn.getBoundingClientRect();
        const cx = br.left + br.width/2;
        const cy = br.top + br.height/2;
        const dx = e.clientX - cx;
        const dy = e.clientY - cy;
        const dist = Math.hypot(dx, dy);
        if(dist < 90) moveNo("near");
      });
    }

    /* YES -> final */
    const yesBtn = document.getElementById("yesBtn");
    const finalCard = document.getElementById("finalCard");
    const finalMsg = document.getElementById("finalMsg");

    if(finalMsg){
      const h = new Date().getHours();
      let saludo = "SabÃ­a que dirÃ­as que sÃ­";
      if(h < 12) saludo = "SabÃ­a que dirÃ­as que sÃ­";
      else if(h < 19) saludo = "SabÃ­a que dirÃ­as que sÃ­";
      else saludo = "SabÃ­a que dirÃ­as que sÃ­";
      finalMsg.textContent =
`${saludo}
PrepÃ¡rate para un dÃ­a bonito,
sonrisas inevitables
y recuerdos que se van a quedar hasta que seamos viejitos.`;
    }

    if(yesBtn){
      yesBtn.addEventListener("click", ()=>{
        allowFinal = true;              // âœ… habilita la Ãºltima pÃ¡gina SOLO aquÃ­
        updateProgress();               // âœ… habilita el botÃ³n "SIGUIENTE" si corresponde
        confettiHeartsFromElement(yesBtn, 34);
        goTo(4, 1);
        setTimeout(()=> {
          if(finalCard) confettiHeartsFromElement(finalCard, 26);
        }, 600);
      });
    }

    /* Download coupon (simple PNG via canvas) */
    const dlCoupon = document.getElementById("dlCoupon");
    function downloadCouponPNG(){
      const canvas = document.createElement("canvas");
      canvas.width = 1200;
      canvas.height = 700;
      const ctx = canvas.getContext("2d");

      ctx.fillStyle = "#ffd1df";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      const x=90,y=90,w=1020,h=520,r=34;
      ctx.fillStyle = "rgba(255,255,255,0.92)";
      roundRect(ctx,x,y,w,h,r,true,false);

      ctx.strokeStyle = "rgba(225,23,79,0.35)";
      ctx.lineWidth = 8;
      roundRect(ctx,x,y,w,h,r,false,true);

      ctx.fillStyle = "#e1174f";
      roundRect(ctx,x,y,w,120,r,true,false);
      ctx.fillStyle = "white";
      ctx.font = "900 56px serif";
      ctx.textAlign = "center";
      ctx.fillText("CupÃ³n San ValentÃ­n", canvas.width/2, y+78);

      ctx.fillStyle = "#2a1f24";
      ctx.font = "800 44px serif";
      ctx.fillText("VÃ¡lido para:", canvas.width/2, y+220);

      ctx.fillStyle = "#e1174f";
      ctx.font = "900 58px serif";
      ctx.fillText("Una cita sorpresa âœ¨", canvas.width/2, y+300);

      ctx.fillStyle = "rgba(42,31,36,0.75)";
      ctx.font = "700 34px serif";
      ctx.fillText(`Iniciales: ${INI_1} + ${INI_2}`, canvas.width/2, y+380);

      ctx.fillStyle = "rgba(42,31,36,0.60)";
      ctx.font = "700 28px serif";
      ctx.fillText("Hecho con amor ğŸ’—", canvas.width/2, y+450);

      const a = document.createElement("a");
      a.download = "cupon_san_valentin.png";
      a.href = canvas.toDataURL("image/png");
      a.click();
      toast("CupÃ³n descargado âœ¨");
    }

    function roundRect(ctx, x, y, w, h, r, fill, stroke){
      if (w < 2*r) r = w/2;
      if (h < 2*r) r = h/2;
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
      if(fill) ctx.fill();
      if(stroke) ctx.stroke();
    }

    if(dlCoupon) dlCoupon.addEventListener("click", downloadCouponPNG);
  </script>
</body>
</html>
